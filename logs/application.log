2025-06-09 20:28:23 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 67899 (/Users/andreyshelyagin/sql-opt/backend/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/sql-opt/backend)
2025-06-09 20:28:23 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-09 20:28:23 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-09 20:28:23 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 71 ms. Found 5 JPA repository interfaces.
2025-06-09 20:28:23 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-09 20:28:23 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-09 20:28:23 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-09 20:28:23 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-09 20:28:23 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 894 ms
2025-06-09 20:28:23 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-09 20:28:24 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@7336fd8f
2025-06-09 20:28:24 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-09 20:28:24 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-09 20:28:24 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-09 20:28:24 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-09 20:28:24 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-09 20:28:24 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-09 20:28:24 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.009s)
2025-06-09 20:28:24 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 3
2025-06-09 20:28:24 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-09 20:28:24 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-09 20:28:24 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-09 20:28:24 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-09 20:28:24 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-09 20:28:24 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-09 20:28:24 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 20:28:25 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-09 20:28:25 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-09 20:28:25 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-09 20:28:25 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-09 20:28:25 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-09 20:28:26 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-09 20:28:26 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-09 20:28:26 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@23b456ac]]
2025-06-09 20:28:26 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-09 20:28:26 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 3.16 seconds (process running for 3.562)
2025-06-09 20:28:29 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-09 20:28:29 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-09 20:28:29 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-09 20:28:29 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:28:37 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:28:37 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:28:38 [http-nio-8080-exec-6] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 20:28:38 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:28:44 [http-nio-8080-exec-4] INFO  c.e.backend.service.ChatService - Processing sendMessage: chatId=10, userId=1, content=select * from my_db
2025-06-09 20:28:44 [http-nio-8080-exec-4] INFO  c.e.backend.service.ChatService - Message saved successfully: id=54
2025-06-09 20:28:44 [http-nio-8080-exec-4] INFO  c.e.backend.service.ChatService - Successfully sent message to /topic/chat/10: id=54
2025-06-09 20:28:44 [http-nio-8080-exec-4] INFO  c.e.b.service.GigaChatAuthService - Attempting to authenticate with GigaChat API
2025-06-09 20:28:45 [reactor-http-nio-2] INFO  c.e.b.service.GigaChatAuthService - Successfully refreshed GigaChat token, expires in 3600 seconds
2025-06-09 20:28:47 [http-nio-8080-exec-4] INFO  c.e.backend.service.ChatService - Successfully sent text message to /topic/chat/10: id=55
2025-06-09 20:28:47 [http-nio-8080-exec-4] INFO  c.e.backend.service.ChatService - Successfully sent SQL message to /topic/chat/10: id=56
2025-06-09 20:28:47 [http-nio-8080-exec-4] INFO  c.e.b.controller.ChatController - Message sent successfully: chatId=10, messageId=54
2025-06-09 20:28:47 [http-nio-8080-exec-5] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=10, query=select * from my_db, llm=Local
2025-06-09 20:28:47 [http-nio-8080-exec-5] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-09 20:28:47 [http-nio-8080-exec-5] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=10, query=select * from my_db, llm=Local
2025-06-09 20:28:47 [http-nio-8080-exec-5] INFO  c.e.backend.service.ChatService - Processing sendMessage: chatId=10, userId=1, content=select * from my_db
2025-06-09 20:28:47 [http-nio-8080-exec-5] INFO  c.e.backend.service.ChatService - Message saved successfully: id=57
2025-06-09 20:28:47 [http-nio-8080-exec-5] INFO  c.e.backend.service.ChatService - Successfully sent message to /topic/chat/10: id=57
2025-06-09 20:28:48 [http-nio-8080-exec-5] INFO  c.e.backend.service.ChatService - Successfully sent text message to /topic/chat/10: id=58
2025-06-09 20:28:48 [http-nio-8080-exec-5] INFO  c.e.backend.service.ChatService - Successfully sent SQL message to /topic/chat/10: id=59
2025-06-09 20:28:54 [http-nio-8080-exec-5] INFO  c.e.backend.service.ChatService - Processing sendMessage: chatId=10, userId=1, content=The provided SQL query `SELECT * FROM my_db` is already optimal, meaning it retrieves all columns (`*`) from the specified table without any filtering or restrictions. This is a common and efficient way to retrieve data from a database.

Therefore, I will return the same query unchanged:

SELECT *
FROM my_db;
2025-06-09 20:28:54 [http-nio-8080-exec-5] INFO  c.e.backend.service.ChatService - Message saved successfully: id=60
2025-06-09 20:28:54 [http-nio-8080-exec-5] INFO  c.e.backend.service.ChatService - Successfully sent message to /topic/chat/10: id=60
2025-06-09 20:28:54 [http-nio-8080-exec-5] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=30
2025-06-09 20:28:54 [http-nio-8080-exec-5] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=30
2025-06-09 20:29:26 [MessageBroker-3] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 2 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(2)-CONNECTED(2)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 18], outboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 10], sockJsScheduler[pool size = 6, active threads = 1, queued tasks = 1, completed tasks = 2]
2025-06-09 20:32:18 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:32:18 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:32:18 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-09 20:32:18 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@23b456ac]]
2025-06-09 20:32:18 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-09 20:32:25 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 20:32:25 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-09 20:32:25 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-09 20:32:27 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 68712 (/Users/andreyshelyagin/sql-opt/backend/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/sql-opt/backend)
2025-06-09 20:32:27 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-09 20:32:28 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-09 20:32:28 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 70 ms. Found 5 JPA repository interfaces.
2025-06-09 20:32:28 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-09 20:32:28 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-09 20:32:28 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-09 20:32:28 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-09 20:32:28 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 758 ms
2025-06-09 20:32:28 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-09 20:32:28 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@7e94e331
2025-06-09 20:32:28 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-09 20:32:28 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-09 20:32:28 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-09 20:32:28 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-09 20:32:28 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-09 20:32:28 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-09 20:32:28 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.010s)
2025-06-09 20:32:28 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 3
2025-06-09 20:32:28 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-09 20:32:28 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-09 20:32:28 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-09 20:32:28 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-09 20:32:28 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-09 20:32:28 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-09 20:32:29 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 20:32:29 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-09 20:32:29 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-09 20:32:30 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-09 20:32:30 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-09 20:32:30 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-09 20:32:30 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-09 20:32:30 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-09 20:32:30 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@87dc829]]
2025-06-09 20:32:30 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-09 20:32:30 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 3.022 seconds (process running for 3.452)
2025-06-09 20:32:33 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-09 20:32:33 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-09 20:32:33 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-09 20:32:33 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:32:49 [http-nio-8080-exec-6] INFO  c.e.b.controller.AuthController - User logged in successfully: username=andrey
2025-06-09 20:32:49 [http-nio-8080-exec-7] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 20:32:49 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:32:52 [http-nio-8080-exec-5] INFO  c.e.backend.service.ChatService - Created chat: id=11, title=Chat 11
2025-06-09 20:32:52 [http-nio-8080-exec-9] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:32:52 [http-nio-8080-exec-9] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:32:52 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:32:54 [http-nio-8080-exec-7] INFO  c.e.backend.service.ChatService - Processing sendMessage: chatId=11, userId=1, content=select * from my_db
2025-06-09 20:32:54 [http-nio-8080-exec-7] INFO  c.e.backend.service.ChatService - Message saved successfully: id=61
2025-06-09 20:32:54 [http-nio-8080-exec-7] INFO  c.e.backend.service.ChatService - Successfully sent message to /topic/chat/11: id=61
2025-06-09 20:32:54 [http-nio-8080-exec-7] INFO  c.e.b.controller.ChatController - Message sent successfully: chatId=11, messageId=61
2025-06-09 20:32:54 [http-nio-8080-exec-8] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=11, query=select * from my_db, llm=Local
2025-06-09 20:32:54 [http-nio-8080-exec-8] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-09 20:32:54 [http-nio-8080-exec-8] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=11, query=select * from my_db, llm=Local
2025-06-09 20:32:54 [http-nio-8080-exec-8] INFO  c.e.backend.service.ChatService - Processing sendMessage: chatId=11, userId=1, content=select * from my_db
2025-06-09 20:32:54 [http-nio-8080-exec-8] INFO  c.e.backend.service.ChatService - Message saved successfully: id=62
2025-06-09 20:32:54 [http-nio-8080-exec-8] INFO  c.e.backend.service.ChatService - Successfully sent message to /topic/chat/11: id=62
2025-06-09 20:33:00 [http-nio-8080-exec-8] INFO  c.e.backend.service.ChatService - Processing sendMessage: chatId=11, userId=1, content=The original query `SELECT * FROM my_db` is already optimal in terms of data retrieval, and it's not necessary to add indexes or alter the table structure. Here's why:

* The query selects all columns (`*`) from a single table (`my_db`), which means PostgreSQL can use an index on the table name to quickly locate matching rows.
* There are no specific constraints, joins, subqueries, or aggregation functions that would require additional indexing.

Therefore, I will return the original query unchanged:

SELECT *
FROM my_db;
2025-06-09 20:33:00 [http-nio-8080-exec-8] INFO  c.e.backend.service.ChatService - Message saved successfully: id=63
2025-06-09 20:33:00 [http-nio-8080-exec-8] INFO  c.e.backend.service.ChatService - Successfully sent message to /topic/chat/11: id=63
2025-06-09 20:33:00 [http-nio-8080-exec-8] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=31
2025-06-09 20:33:00 [http-nio-8080-exec-8] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=31
2025-06-09 20:33:30 [MessageBroker-3] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[2 current WS(2)-HttpStream(0)-HttpPoll(0), 3 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(3)-CONNECTED(3)-DISCONNECT(1)], stompBrokerRelay[null], inboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 36], outboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 9], sockJsScheduler[pool size = 7, active threads = 1, queued tasks = 1, completed tasks = 2]
2025-06-09 20:33:42 [http-nio-8080-exec-3] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:33:42 [http-nio-8080-exec-3] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:33:42 [http-nio-8080-exec-4] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 20:33:42 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:33:46 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:33:46 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:33:46 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:33:47 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:33:47 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:33:47 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:33:49 [http-nio-8080-exec-8] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:33:49 [http-nio-8080-exec-8] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:33:49 [http-nio-8080-exec-1] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 20:33:50 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:35:56 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:35:56 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:35:56 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:35:56 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:35:56 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-09 20:35:56 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@87dc829]]
2025-06-09 20:35:56 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-09 20:36:01 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 20:36:01 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-09 20:36:01 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-09 20:36:03 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 69540 (/Users/andreyshelyagin/sql-opt/backend/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/sql-opt/backend)
2025-06-09 20:36:03 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-09 20:36:03 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-09 20:36:03 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 79 ms. Found 5 JPA repository interfaces.
2025-06-09 20:36:04 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-09 20:36:04 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-09 20:36:04 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-09 20:36:04 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-09 20:36:04 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 781 ms
2025-06-09 20:36:04 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-09 20:36:04 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@3181d4de
2025-06-09 20:36:04 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-09 20:36:04 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-09 20:36:04 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-09 20:36:04 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-09 20:36:04 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-09 20:36:04 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-09 20:36:04 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.019s)
2025-06-09 20:36:04 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 3
2025-06-09 20:36:04 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-09 20:36:04 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-09 20:36:04 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-09 20:36:04 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-09 20:36:04 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-09 20:36:04 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-09 20:36:05 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 20:36:05 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-09 20:36:05 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-09 20:36:06 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-09 20:36:06 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-09 20:36:06 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-09 20:36:06 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-09 20:36:06 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-09 20:36:06 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@781f8d26]]
2025-06-09 20:36:06 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-09 20:36:06 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 3.265 seconds (process running for 3.752)
2025-06-09 20:36:06 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-09 20:36:06 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-09 20:36:06 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 0 ms
2025-06-09 20:36:07 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:36:11 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:36:25 [http-nio-8080-exec-9] INFO  c.e.b.controller.AuthController - User logged in successfully: username=andrey
2025-06-09 20:36:25 [http-nio-8080-exec-1] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 20:36:25 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:36:26 [http-nio-8080-exec-1] INFO  c.e.backend.service.ChatService - Created chat: id=12, title=Chat 12
2025-06-09 20:36:27 [http-nio-8080-exec-6] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:36:27 [http-nio-8080-exec-6] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:36:27 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:36:36 [http-nio-8080-exec-5] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=12, query=select * from my_db, llm=Local
2025-06-09 20:36:36 [http-nio-8080-exec-5] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-09 20:36:36 [http-nio-8080-exec-5] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=12, query=select * from my_db, llm=Local
2025-06-09 20:36:48 [http-nio-8080-exec-5] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Error: 0, SQLState: 23502
2025-06-09 20:36:48 [http-nio-8080-exec-5] ERROR o.h.e.jdbc.spi.SqlExceptionHelper - ERROR: null value in column "message_id" of relation "sql_queries" violates not-null constraint
  Подробности: Failing row contains (32, 2025-06-09 20:36:48.298551, null, **Explanation**

The original query `SELECT * FROM my_db` is a s..., select * from my_db, null, null).
2025-06-09 20:36:48 [http-nio-8080-exec-5] ERROR c.e.b.service.SqlOptimizationService - Unexpected error during query optimization: could not execute statement [ERROR: null value in column "message_id" of relation "sql_queries" violates not-null constraint
  Подробности: Failing row contains (32, 2025-06-09 20:36:48.298551, null, **Explanation**

The original query `SELECT * FROM my_db` is a s..., select * from my_db, null, null).] [insert into sql_queries (created_at,database_connection_id,execution_time_ms,message_id,optimized_query,original_query) values (?,?,?,?,?,?)]; SQL [insert into sql_queries (created_at,database_connection_id,execution_time_ms,message_id,optimized_query,original_query) values (?,?,?,?,?,?)]; constraint [message_id" of relation "sql_queries]
org.springframework.dao.DataIntegrityViolationException: could not execute statement [ERROR: null value in column "message_id" of relation "sql_queries" violates not-null constraint
  Подробности: Failing row contains (32, 2025-06-09 20:36:48.298551, null, **Explanation**

The original query `SELECT * FROM my_db` is a s..., select * from my_db, null, null).] [insert into sql_queries (created_at,database_connection_id,execution_time_ms,message_id,optimized_query,original_query) values (?,?,?,?,?,?)]; SQL [insert into sql_queries (created_at,database_connection_id,execution_time_ms,message_id,optimized_query,original_query) values (?,?,?,?,?,?)]; constraint [message_id" of relation "sql_queries]
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.convertHibernateAccessException(HibernateJpaDialect.java:290)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.translateExceptionIfPossible(HibernateJpaDialect.java:241)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.translateExceptionIfPossible(AbstractEntityManagerFactoryBean.java:550)
	at org.springframework.dao.support.ChainedPersistenceExceptionTranslator.translateExceptionIfPossible(ChainedPersistenceExceptionTranslator.java:61)
	at org.springframework.dao.support.DataAccessUtils.translateIfNecessary(DataAccessUtils.java:335)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:152)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.jpa.repository.support.CrudMethodMetadataPostProcessor$CrudMethodMetadataPopulatingMethodInterceptor.invoke(CrudMethodMetadataPostProcessor.java:164)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:220)
	at jdk.proxy2/jdk.proxy2.$Proxy157.save(Unknown Source)
	at com.example.backend.service.SqlOptimizationService.lambda$optimizeQuery$5(SqlOptimizationService.java:121)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:132)
	at reactor.core.publisher.MonoPeekTerminal$MonoTerminalPeekSubscriber.onNext(MonoPeekTerminal.java:180)
	at reactor.core.publisher.MonoPeekTerminal$MonoTerminalPeekSubscriber.onNext(MonoPeekTerminal.java:180)
	at reactor.core.publisher.SerializedSubscriber.onNext(SerializedSubscriber.java:99)
	at reactor.core.publisher.FluxRetryWhen$RetryWhenMainSubscriber.onNext(FluxRetryWhen.java:178)
	at reactor.core.publisher.MonoCallable$MonoCallableSubscription.request(MonoCallable.java:156)
	at reactor.core.publisher.Operators$MultiSubscriptionSubscriber.set(Operators.java:2367)
	at reactor.core.publisher.Operators$MultiSubscriptionSubscriber.onSubscribe(Operators.java:2241)
	at reactor.core.publisher.MonoCallable.subscribe(MonoCallable.java:48)
	at reactor.core.publisher.FluxRetryWhen.subscribe(FluxRetryWhen.java:81)
	at reactor.core.publisher.MonoRetryWhen.subscribeOrReturn(MonoRetryWhen.java:46)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4547)
	at reactor.core.publisher.FluxFlatMap.trySubscribeScalarMap(FluxFlatMap.java:202)
	at reactor.core.publisher.MonoFlatMap.subscribeOrReturn(MonoFlatMap.java:53)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4547)
	at org.springframework.web.servlet.mvc.method.annotation.ReactiveTypeHandler$DeferredResultSubscriber.connect(ReactiveTypeHandler.java:465)
	at org.springframework.web.servlet.mvc.method.annotation.ReactiveTypeHandler.handleValue(ReactiveTypeHandler.java:163)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler.handleReturnValue(ResponseBodyEmitterReturnValueHandler.java:154)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:920)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:830)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:547)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:614)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at com.example.backend.security.JwtTokenFilter.doFilterInternal(JwtTokenFilter.java:34)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: org.hibernate.exception.ConstraintViolationException: could not execute statement [ERROR: null value in column "message_id" of relation "sql_queries" violates not-null constraint
  Подробности: Failing row contains (32, 2025-06-09 20:36:48.298551, null, **Explanation**

The original query `SELECT * FROM my_db` is a s..., select * from my_db, null, null).] [insert into sql_queries (created_at,database_connection_id,execution_time_ms,message_id,optimized_query,original_query) values (?,?,?,?,?,?)]
	at org.hibernate.exception.internal.SQLStateConversionDelegate.convert(SQLStateConversionDelegate.java:97)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:58)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:108)
	at org.hibernate.engine.jdbc.internal.ResultSetReturnImpl.executeUpdate(ResultSetReturnImpl.java:197)
	at org.hibernate.id.insert.GetGeneratedKeysDelegate.performInsert(GetGeneratedKeysDelegate.java:107)
	at org.hibernate.engine.jdbc.mutation.internal.MutationExecutorPostInsertSingleTable.execute(MutationExecutorPostInsertSingleTable.java:100)
	at org.hibernate.persister.entity.mutation.InsertCoordinator.doStaticInserts(InsertCoordinator.java:175)
	at org.hibernate.persister.entity.mutation.InsertCoordinator.coordinateInsert(InsertCoordinator.java:113)
	at org.hibernate.persister.entity.AbstractEntityPersister.insert(AbstractEntityPersister.java:2868)
	at org.hibernate.action.internal.EntityIdentityInsertAction.execute(EntityIdentityInsertAction.java:81)
	at org.hibernate.engine.spi.ActionQueue.execute(ActionQueue.java:670)
	at org.hibernate.engine.spi.ActionQueue.addResolvedEntityInsertAction(ActionQueue.java:291)
	at org.hibernate.engine.spi.ActionQueue.addInsertAction(ActionQueue.java:272)
	at org.hibernate.engine.spi.ActionQueue.addAction(ActionQueue.java:322)
	at org.hibernate.event.internal.AbstractSaveEventListener.addInsertAction(AbstractSaveEventListener.java:386)
	at org.hibernate.event.internal.AbstractSaveEventListener.performSaveOrReplicate(AbstractSaveEventListener.java:300)
	at org.hibernate.event.internal.AbstractSaveEventListener.performSave(AbstractSaveEventListener.java:219)
	at org.hibernate.event.internal.AbstractSaveEventListener.saveWithGeneratedId(AbstractSaveEventListener.java:134)
	at org.hibernate.event.internal.DefaultPersistEventListener.entityIsTransient(DefaultPersistEventListener.java:175)
	at org.hibernate.event.internal.DefaultPersistEventListener.persist(DefaultPersistEventListener.java:93)
	at org.hibernate.event.internal.DefaultPersistEventListener.onPersist(DefaultPersistEventListener.java:77)
	at org.hibernate.event.internal.DefaultPersistEventListener.onPersist(DefaultPersistEventListener.java:54)
	at org.hibernate.event.service.internal.EventListenerGroupImpl.fireEventOnEachListener(EventListenerGroupImpl.java:127)
	at org.hibernate.internal.SessionImpl.firePersist(SessionImpl.java:754)
	at org.hibernate.internal.SessionImpl.persist(SessionImpl.java:738)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.orm.jpa.ExtendedEntityManagerCreator$ExtendedEntityManagerInvocationHandler.invoke(ExtendedEntityManagerCreator.java:364)
	at jdk.proxy2/jdk.proxy2.$Proxy140.persist(Unknown Source)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:319)
	at jdk.proxy2/jdk.proxy2.$Proxy140.persist(Unknown Source)
	at org.springframework.data.jpa.repository.support.SimpleJpaRepository.save(SimpleJpaRepository.java:618)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:351)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker$RepositoryFragmentMethodInvoker.lambda$new$0(RepositoryMethodInvoker.java:277)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.doInvoke(RepositoryMethodInvoker.java:170)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.invoke(RepositoryMethodInvoker.java:158)
	at org.springframework.data.repository.core.support.RepositoryComposition$RepositoryFragments.invoke(RepositoryComposition.java:516)
	at org.springframework.data.repository.core.support.RepositoryComposition.invoke(RepositoryComposition.java:285)
	at org.springframework.data.repository.core.support.RepositoryFactorySupport$ImplementationMethodExecutionInterceptor.invoke(RepositoryFactorySupport.java:628)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.doInvoke(QueryExecutorMethodInterceptor.java:168)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.invoke(QueryExecutorMethodInterceptor.java:143)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.projection.DefaultMethodInvokingMethodInterceptor.invoke(DefaultMethodInvokingMethodInterceptor.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	... 124 common frames omitted
Caused by: org.postgresql.util.PSQLException: ERROR: null value in column "message_id" of relation "sql_queries" violates not-null constraint
  Подробности: Failing row contains (32, 2025-06-09 20:36:48.298551, null, **Explanation**

The original query `SELECT * FROM my_db` is a s..., select * from my_db, null, null).
	at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2713)
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2401)
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:368)
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:498)
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:415)
	at org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:190)
	at org.postgresql.jdbc.PgPreparedStatement.executeUpdate(PgPreparedStatement.java:152)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeUpdate(ProxyPreparedStatement.java:61)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeUpdate(HikariProxyPreparedStatement.java)
	at org.hibernate.engine.jdbc.internal.ResultSetReturnImpl.executeUpdate(ResultSetReturnImpl.java:194)
	... 174 common frames omitted
2025-06-09 20:36:48 [http-nio-8080-exec-5] ERROR c.e.b.c.SqlOptimizationController - SQL optimization failed: Internal error during query optimization
com.example.backend.exception.ApiException: Internal error during query optimization
	at com.example.backend.service.SqlOptimizationService.lambda$optimizeQuery$7(SqlOptimizationService.java:136)
	at reactor.core.publisher.Mono.lambda$onErrorMap$28(Mono.java:3850)
	at reactor.core.publisher.FluxOnErrorResume$ResumeSubscriber.onError(FluxOnErrorResume.java:94)
	at reactor.core.publisher.MonoFlatMap$FlatMapMain.onNext(MonoFlatMap.java:136)
	at reactor.core.publisher.MonoPeekTerminal$MonoTerminalPeekSubscriber.onNext(MonoPeekTerminal.java:180)
	at reactor.core.publisher.MonoPeekTerminal$MonoTerminalPeekSubscriber.onNext(MonoPeekTerminal.java:180)
	at reactor.core.publisher.SerializedSubscriber.onNext(SerializedSubscriber.java:99)
	at reactor.core.publisher.FluxRetryWhen$RetryWhenMainSubscriber.onNext(FluxRetryWhen.java:178)
	at reactor.core.publisher.MonoCallable$MonoCallableSubscription.request(MonoCallable.java:156)
	at reactor.core.publisher.Operators$MultiSubscriptionSubscriber.set(Operators.java:2367)
	at reactor.core.publisher.Operators$MultiSubscriptionSubscriber.onSubscribe(Operators.java:2241)
	at reactor.core.publisher.MonoCallable.subscribe(MonoCallable.java:48)
	at reactor.core.publisher.FluxRetryWhen.subscribe(FluxRetryWhen.java:81)
	at reactor.core.publisher.MonoRetryWhen.subscribeOrReturn(MonoRetryWhen.java:46)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4547)
	at reactor.core.publisher.FluxFlatMap.trySubscribeScalarMap(FluxFlatMap.java:202)
	at reactor.core.publisher.MonoFlatMap.subscribeOrReturn(MonoFlatMap.java:53)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4547)
	at org.springframework.web.servlet.mvc.method.annotation.ReactiveTypeHandler$DeferredResultSubscriber.connect(ReactiveTypeHandler.java:465)
	at org.springframework.web.servlet.mvc.method.annotation.ReactiveTypeHandler.handleValue(ReactiveTypeHandler.java:163)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler.handleReturnValue(ResponseBodyEmitterReturnValueHandler.java:154)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:920)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:830)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:547)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:614)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at com.example.backend.security.JwtTokenFilter.doFilterInternal(JwtTokenFilter.java:34)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-06-09 20:36:48 [http-nio-8080-exec-5] ERROR c.e.b.c.SqlOptimizationController - API error: status=500 INTERNAL_SERVER_ERROR, message=Internal error during query optimization
2025-06-09 20:37:06 [MessageBroker-3] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[3 current WS(3)-HttpStream(0)-HttpPoll(0), 4 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(4)-CONNECTED(4)-DISCONNECT(1)], stompBrokerRelay[null], inboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 48], outboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 9], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 2]
2025-06-09 20:38:05 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:38:05 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:38:05 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:38:05 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:38:05 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:38:05 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:38:05 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-09 20:38:05 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@781f8d26]]
2025-06-09 20:38:05 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-09 20:38:11 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 20:38:11 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-09 20:38:11 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-09 20:41:34 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 70625 (/Users/andreyshelyagin/sql-opt/backend/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/sql-opt/backend)
2025-06-09 20:41:34 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-09 20:41:35 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-09 20:41:35 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 83 ms. Found 5 JPA repository interfaces.
2025-06-09 20:41:35 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-09 20:41:35 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-09 20:41:35 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-09 20:41:35 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-09 20:41:35 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 894 ms
2025-06-09 20:41:35 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-09 20:41:35 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@539fc5d1
2025-06-09 20:41:35 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-09 20:41:35 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-09 20:41:35 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-09 20:41:35 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-09 20:41:35 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-09 20:41:35 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-09 20:41:35 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.014s)
2025-06-09 20:41:35 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 3
2025-06-09 20:41:35 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-09 20:41:35 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-09 20:41:35 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-09 20:41:35 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-09 20:41:36 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-09 20:41:36 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-09 20:41:36 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 20:41:37 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-09 20:41:37 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-09 20:41:37 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-09 20:41:37 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-09 20:41:37 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-09 20:41:38 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-09 20:41:38 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-09 20:41:38 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@3e095ba6]]
2025-06-09 20:41:38 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-09 20:41:38 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 3.581 seconds (process running for 3.901)
2025-06-09 20:41:40 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-09 20:41:40 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-09 20:41:40 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-09 20:41:41 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:41:41 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:41:41 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:41:52 [http-nio-8080-exec-2] INFO  c.e.b.controller.AuthController - User logged in successfully: username=andrey
2025-06-09 20:41:52 [http-nio-8080-exec-4] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 20:41:52 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:41:55 [http-nio-8080-exec-3] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:41:55 [http-nio-8080-exec-3] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:41:55 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:41:58 [http-nio-8080-exec-1] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:41:58 [http-nio-8080-exec-1] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:41:58 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:41:59 [http-nio-8080-exec-2] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=12, query=select * from my_db, llm=Local
2025-06-09 20:41:59 [http-nio-8080-exec-2] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-09 20:41:59 [http-nio-8080-exec-2] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=12, query=select * from my_db, llm=Local
2025-06-09 20:42:10 [http-nio-8080-exec-2] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=33
2025-06-09 20:42:10 [http-nio-8080-exec-2] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/12: id=64
2025-06-09 20:42:10 [http-nio-8080-exec-2] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=33
2025-06-09 20:42:38 [MessageBroker-3] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[4 current WS(4)-HttpStream(0)-HttpPoll(0), 6 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(6)-CONNECTED(6)-DISCONNECT(2)], stompBrokerRelay[null], inboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 75], outboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 14], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 2]
2025-06-09 20:42:56 [http-nio-8080-exec-1] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:42:56 [http-nio-8080-exec-1] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:42:56 [http-nio-8080-exec-3] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 20:42:56 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:42:59 [http-nio-8080-exec-10] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:42:59 [http-nio-8080-exec-10] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:42:59 [http-nio-8080-exec-3] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 20:42:59 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:43:46 [http-nio-8080-exec-4] INFO  c.e.backend.service.ChatService - Created chat: id=13, title=Chat 13
2025-06-09 20:43:46 [http-nio-8080-exec-9] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:43:46 [http-nio-8080-exec-9] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:43:46 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:43:50 [http-nio-8080-exec-8] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=13, query=select * from my_db, llm=GigaChat
2025-06-09 20:43:50 [http-nio-8080-exec-8] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-09 20:43:50 [http-nio-8080-exec-8] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=13, query=select * from my_db, llm=GigaChat
2025-06-09 20:43:50 [http-nio-8080-exec-8] INFO  c.e.b.service.GigaChatAuthService - Attempting to authenticate with GigaChat API
2025-06-09 20:43:53 [reactor-http-nio-2] INFO  c.e.b.service.GigaChatAuthService - Successfully refreshed GigaChat token, expires in 3600 seconds
2025-06-09 20:43:55 [reactor-http-nio-2] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=34
2025-06-09 20:43:55 [reactor-http-nio-2] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/13: id=65
2025-06-09 20:43:55 [reactor-http-nio-2] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=34
2025-06-09 20:44:13 [http-nio-8080-exec-4] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:44:13 [http-nio-8080-exec-4] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:44:14 [http-nio-8080-exec-7] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 20:44:14 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:44:26 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:44:26 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:44:26 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:44:26 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:44:26 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:44:26 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:44:26 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:44:26 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:44:26 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-09 20:44:26 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@3e095ba6]]
2025-06-09 20:44:26 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-09 20:44:33 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 20:44:33 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-09 20:44:33 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-09 20:47:39 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 71791 (/Users/andreyshelyagin/sql-opt/backend/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/sql-opt/backend)
2025-06-09 20:47:39 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-09 20:47:39 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-09 20:47:39 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 76 ms. Found 5 JPA repository interfaces.
2025-06-09 20:47:40 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-09 20:47:40 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-09 20:47:40 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-09 20:47:40 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-09 20:47:40 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 855 ms
2025-06-09 20:47:40 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-09 20:47:40 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@539fc5d1
2025-06-09 20:47:40 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-09 20:47:40 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-09 20:47:40 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-09 20:47:40 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-09 20:47:40 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-09 20:47:40 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-09 20:47:40 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.015s)
2025-06-09 20:47:40 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 3
2025-06-09 20:47:40 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-09 20:47:40 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-09 20:47:40 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-09 20:47:40 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-09 20:47:40 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-09 20:47:40 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-09 20:47:41 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 20:47:41 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-09 20:47:41 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-09 20:47:41 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-09 20:47:41 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-09 20:47:41 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-09 20:47:42 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-09 20:47:42 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-09 20:47:42 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@3e095ba6]]
2025-06-09 20:47:42 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-09 20:47:42 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 3.365 seconds (process running for 3.821)
2025-06-09 20:47:45 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-09 20:47:45 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-09 20:47:45 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-06-09 20:47:45 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:47:45 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:47:45 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:47:47 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:48:04 [http-nio-8080-exec-9] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:48:04 [http-nio-8080-exec-9] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:48:05 [http-nio-8080-exec-7] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:48:05 [http-nio-8080-exec-7] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:48:05 [http-nio-8080-exec-8] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:48:05 [http-nio-8080-exec-8] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:48:08 [http-nio-8080-exec-10] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:48:08 [http-nio-8080-exec-10] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:48:14 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-09 20:48:14 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@3e095ba6]]
2025-06-09 20:48:14 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-09 20:48:26 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 20:48:26 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-09 20:48:26 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-09 20:48:28 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 71976 (/Users/andreyshelyagin/sql-opt/backend/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/sql-opt/backend)
2025-06-09 20:48:28 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-09 20:48:28 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-09 20:48:28 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 93 ms. Found 5 JPA repository interfaces.
2025-06-09 20:48:29 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-09 20:48:29 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-09 20:48:29 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-09 20:48:29 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-09 20:48:29 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1071 ms
2025-06-09 20:48:29 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-09 20:48:29 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@44dd0d38
2025-06-09 20:48:29 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-09 20:48:29 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-09 20:48:29 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-09 20:48:29 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-09 20:48:29 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-09 20:48:29 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-09 20:48:29 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.018s)
2025-06-09 20:48:29 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 3
2025-06-09 20:48:29 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-09 20:48:29 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-09 20:48:29 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-09 20:48:29 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-09 20:48:29 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-09 20:48:29 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-09 20:48:30 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 20:48:30 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-09 20:48:30 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-09 20:48:31 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-09 20:48:31 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-09 20:48:31 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-09 20:48:31 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-09 20:48:31 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-09 20:48:31 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@87dc829]]
2025-06-09 20:48:31 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-09 20:48:31 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 4.043 seconds (process running for 4.424)
2025-06-09 20:48:55 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-09 20:48:55 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-09 20:48:55 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-09 20:48:55 [http-nio-8080-exec-2] INFO  c.e.b.controller.AuthController - User logged in successfully: username=andrey
2025-06-09 20:48:55 [http-nio-8080-exec-4] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 20:48:55 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:48:57 [http-nio-8080-exec-8] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:48:57 [http-nio-8080-exec-8] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:48:57 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:48:58 [http-nio-8080-exec-9] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:48:58 [http-nio-8080-exec-9] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:48:58 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:49:01 [http-nio-8080-exec-3] INFO  c.e.backend.service.ChatService - Created chat: id=14, title=Chat 14
2025-06-09 20:49:01 [http-nio-8080-exec-6] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:49:01 [http-nio-8080-exec-6] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:49:01 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:49:03 [http-nio-8080-exec-9] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=14, query=select * from my_db, llm=Local
2025-06-09 20:49:03 [http-nio-8080-exec-9] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-09 20:49:03 [http-nio-8080-exec-9] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=14, query=select * from my_db, llm=Local
2025-06-09 20:49:03 [http-nio-8080-exec-9] INFO  c.e.b.service.SqlOptimizationService - Successfully sent user message to /topic/chat/14: id=66
2025-06-09 20:49:14 [http-nio-8080-exec-9] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=35
2025-06-09 20:49:14 [http-nio-8080-exec-9] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/14: id=67
2025-06-09 20:49:14 [http-nio-8080-exec-9] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=35
2025-06-09 20:49:16 [http-nio-8080-exec-6] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:49:16 [http-nio-8080-exec-6] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:49:17 [http-nio-8080-exec-5] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 20:49:17 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:49:18 [http-nio-8080-exec-9] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:49:18 [http-nio-8080-exec-9] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:49:19 [http-nio-8080-exec-6] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 20:49:19 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:49:27 [http-nio-8080-exec-4] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=14, query=select * from my_db, llm=GigaChat
2025-06-09 20:49:27 [http-nio-8080-exec-4] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-09 20:49:27 [http-nio-8080-exec-4] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=14, query=select * from my_db, llm=GigaChat
2025-06-09 20:49:27 [http-nio-8080-exec-4] INFO  c.e.b.service.SqlOptimizationService - Successfully sent user message to /topic/chat/14: id=68
2025-06-09 20:49:27 [http-nio-8080-exec-4] INFO  c.e.b.service.GigaChatAuthService - Attempting to authenticate with GigaChat API
2025-06-09 20:49:31 [MessageBroker-4] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 6 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(6)-CONNECTED(6)-DISCONNECT(3)], stompBrokerRelay[null], inboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 69], outboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 17], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 2]
2025-06-09 20:49:33 [reactor-http-nio-1] ERROR c.e.b.service.GigaChatAuthService - Error during token refresh: Failed to resolve 'ngw.devices.sberbank.ru' [A(1), AAAA(28)] and search domain query for configured domains failed as well: [lan]
org.springframework.web.reactive.function.client.WebClientRequestException: Failed to resolve 'ngw.devices.sberbank.ru' [A(1), AAAA(28)] and search domain query for configured domains failed as well: [lan]
	at org.springframework.web.reactive.function.client.ExchangeFunctions$DefaultExchangeFunction.lambda$wrapException$9(ExchangeFunctions.java:136)
	Suppressed: reactor.core.publisher.FluxOnAssembly$OnAssemblyException: 
Error has been observed at the following site(s):
	*__checkpoint ⇢ Request to POST https://ngw.devices.sberbank.ru:9443/api/v2/oauth [DefaultWebClient]
Original Stack Trace:
		at org.springframework.web.reactive.function.client.ExchangeFunctions$DefaultExchangeFunction.lambda$wrapException$9(ExchangeFunctions.java:136)
		at reactor.core.publisher.MonoErrorSupplied.subscribe(MonoErrorSupplied.java:55)
		at reactor.core.publisher.Mono.subscribe(Mono.java:4563)
		at reactor.core.publisher.FluxOnErrorResume$ResumeSubscriber.onError(FluxOnErrorResume.java:103)
		at reactor.core.publisher.FluxPeek$PeekSubscriber.onError(FluxPeek.java:222)
		at reactor.core.publisher.FluxPeek$PeekSubscriber.onError(FluxPeek.java:222)
		at reactor.core.publisher.FluxPeek$PeekSubscriber.onError(FluxPeek.java:222)
		at reactor.core.publisher.MonoNext$NextSubscriber.onError(MonoNext.java:93)
		at reactor.core.publisher.MonoFlatMapMany$FlatMapManyMain.onError(MonoFlatMapMany.java:205)
		at reactor.core.publisher.SerializedSubscriber.onError(SerializedSubscriber.java:124)
		at reactor.core.publisher.FluxRetryWhen$RetryWhenMainSubscriber.whenError(FluxRetryWhen.java:229)
		at reactor.core.publisher.FluxRetryWhen$RetryWhenOtherSubscriber.onError(FluxRetryWhen.java:279)
		at reactor.core.publisher.FluxContextWrite$ContextWriteSubscriber.onError(FluxContextWrite.java:121)
		at reactor.core.publisher.FluxConcatMapNoPrefetch$FluxConcatMapNoPrefetchSubscriber.maybeOnError(FluxConcatMapNoPrefetch.java:327)
		at reactor.core.publisher.FluxConcatMapNoPrefetch$FluxConcatMapNoPrefetchSubscriber.onNext(FluxConcatMapNoPrefetch.java:212)
		at reactor.core.publisher.FluxContextWrite$ContextWriteSubscriber.onNext(FluxContextWrite.java:107)
		at reactor.core.publisher.SinkManyEmitterProcessor.drain(SinkManyEmitterProcessor.java:476)
		at reactor.core.publisher.SinkManyEmitterProcessor$EmitterInner.drainParent(SinkManyEmitterProcessor.java:620)
		at reactor.core.publisher.FluxPublish$PubSubInner.request(FluxPublish.java:874)
		at reactor.core.publisher.FluxContextWrite$ContextWriteSubscriber.request(FluxContextWrite.java:136)
		at reactor.core.publisher.FluxConcatMapNoPrefetch$FluxConcatMapNoPrefetchSubscriber.request(FluxConcatMapNoPrefetch.java:337)
		at reactor.core.publisher.FluxContextWrite$ContextWriteSubscriber.request(FluxContextWrite.java:136)
		at reactor.core.publisher.Operators$DeferredSubscription.request(Operators.java:1743)
		at reactor.core.publisher.FluxRetryWhen$RetryWhenMainSubscriber.onError(FluxRetryWhen.java:196)
		at reactor.core.publisher.MonoCreate$DefaultMonoSink.error(MonoCreate.java:205)
		at reactor.netty.http.client.HttpClientConnect$MonoHttpConnect$ClientTransportSubscriber.onError(HttpClientConnect.java:311)
		at reactor.core.publisher.MonoCreate$DefaultMonoSink.error(MonoCreate.java:205)
		at reactor.netty.resources.DefaultPooledConnectionProvider$DisposableAcquire.onError(DefaultPooledConnectionProvider.java:172)
		at reactor.netty.internal.shaded.reactor.pool.AbstractPool$Borrower.fail(AbstractPool.java:488)
		at reactor.netty.internal.shaded.reactor.pool.SimpleDequePool.lambda$drainLoop$9(SimpleDequePool.java:436)
		at reactor.core.publisher.FluxDoOnEach$DoOnEachSubscriber.onError(FluxDoOnEach.java:186)
		at reactor.core.publisher.MonoCreate$DefaultMonoSink.error(MonoCreate.java:205)
		at reactor.netty.resources.DefaultPooledConnectionProvider$PooledConnectionAllocator$PooledConnectionInitializer.onError(DefaultPooledConnectionProvider.java:583)
		at reactor.core.publisher.MonoFlatMap$FlatMapMain.secondError(MonoFlatMap.java:241)
		at reactor.core.publisher.MonoFlatMap$FlatMapInner.onError(MonoFlatMap.java:315)
		at reactor.core.publisher.FluxOnErrorResume$ResumeSubscriber.onError(FluxOnErrorResume.java:106)
		at reactor.core.publisher.Operators.error(Operators.java:198)
		at reactor.core.publisher.MonoError.subscribe(MonoError.java:53)
		at reactor.core.publisher.Mono.subscribe(Mono.java:4563)
		at reactor.core.publisher.FluxOnErrorResume$ResumeSubscriber.onError(FluxOnErrorResume.java:103)
		at reactor.netty.transport.TransportConnector$MonoChannelPromise.tryFailure(TransportConnector.java:576)
		at reactor.netty.transport.TransportConnector.lambda$doResolveAndConnect$11(TransportConnector.java:375)
		at io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:590)
		at io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:557)
		at io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:492)
		at io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:636)
		at io.netty.util.concurrent.DefaultPromise.setFailure0(DefaultPromise.java:629)
		at io.netty.util.concurrent.DefaultPromise.setFailure(DefaultPromise.java:110)
		at io.netty.resolver.InetSocketAddressResolver$2.operationComplete(InetSocketAddressResolver.java:86)
		at io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:590)
		at io.netty.util.concurrent.DefaultPromise.notifyListeners0(DefaultPromise.java:583)
		at io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:559)
		at io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:492)
		at io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:636)
		at io.netty.util.concurrent.DefaultPromise.setFailure0(DefaultPromise.java:629)
		at io.netty.util.concurrent.DefaultPromise.tryFailure(DefaultPromise.java:118)
		at io.netty.resolver.dns.DnsResolveContext$1.operationComplete(DnsResolveContext.java:257)
		at io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:590)
		at io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:557)
		at io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:492)
		at io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:636)
		at io.netty.util.concurrent.DefaultPromise.setFailure0(DefaultPromise.java:629)
		at io.netty.util.concurrent.DefaultPromise.tryFailure(DefaultPromise.java:118)
		at io.netty.resolver.dns.DnsResolveContext.finishResolve(DnsResolveContext.java:1133)
		at io.netty.resolver.dns.DnsResolveContext.tryToFinishResolve(DnsResolveContext.java:1072)
		at io.netty.resolver.dns.DnsResolveContext.query(DnsResolveContext.java:444)
		at io.netty.resolver.dns.DnsResolveContext.access$700(DnsResolveContext.java:68)
		at io.netty.resolver.dns.DnsResolveContext$2.operationComplete(DnsResolveContext.java:513)
		at io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:590)
		at io.netty.util.concurrent.DefaultPromise.notifyListeners0(DefaultPromise.java:583)
		at io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:559)
		at io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:492)
		at io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:636)
		at io.netty.util.concurrent.DefaultPromise.setFailure0(DefaultPromise.java:629)
		at io.netty.util.concurrent.DefaultPromise.tryFailure(DefaultPromise.java:118)
		at io.netty.resolver.dns.DnsQueryContext.finishFailure(DnsQueryContext.java:380)
		at io.netty.resolver.dns.DnsQueryContext$5.run(DnsQueryContext.java:315)
		at io.netty.util.concurrent.PromiseTask.runTask(PromiseTask.java:98)
		at io.netty.util.concurrent.ScheduledFutureTask.run(ScheduledFutureTask.java:153)
		at io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:173)
		at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:166)
		at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:470)
		at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:569)
		at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)
		at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
		at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
		at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: io.netty.resolver.dns.DnsResolveContext$SearchDomainUnknownHostException: Failed to resolve 'ngw.devices.sberbank.ru' [A(1), AAAA(28)] and search domain query for configured domains failed as well: [lan]
	at io.netty.resolver.dns.DnsResolveContext.finishResolve(DnsResolveContext.java:1125)
	at io.netty.resolver.dns.DnsResolveContext.tryToFinishResolve(DnsResolveContext.java:1072)
	at io.netty.resolver.dns.DnsResolveContext.query(DnsResolveContext.java:444)
	at io.netty.resolver.dns.DnsResolveContext.access$700(DnsResolveContext.java:68)
	at io.netty.resolver.dns.DnsResolveContext$2.operationComplete(DnsResolveContext.java:513)
	at io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:590)
	at io.netty.util.concurrent.DefaultPromise.notifyListeners0(DefaultPromise.java:583)
	at io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:559)
	at io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:492)
	at io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:636)
	at io.netty.util.concurrent.DefaultPromise.setFailure0(DefaultPromise.java:629)
	at io.netty.util.concurrent.DefaultPromise.tryFailure(DefaultPromise.java:118)
	at io.netty.resolver.dns.DnsQueryContext.finishFailure(DnsQueryContext.java:380)
	at io.netty.resolver.dns.DnsQueryContext$5.run(DnsQueryContext.java:315)
	at io.netty.util.concurrent.PromiseTask.runTask(PromiseTask.java:98)
	at io.netty.util.concurrent.ScheduledFutureTask.run(ScheduledFutureTask.java:153)
	at io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:173)
	at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:166)
	at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:470)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:569)
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: io.netty.resolver.dns.DnsNameResolverTimeoutException: [6941: /8.8.8.8:53] DefaultDnsQuestion(ngw.devices.sberbank.ru. IN A) query '6941' via UDP timed out after 5000 milliseconds (no stack trace available)
2025-06-09 20:49:33 [reactor-http-nio-1] WARN  c.e.b.service.GigaChatAuthService - Retrying token refresh, attempt: 1
2025-06-09 20:49:35 [reactor-http-nio-3] INFO  c.e.b.service.GigaChatAuthService - Successfully refreshed GigaChat token, expires in 3600 seconds
2025-06-09 20:49:37 [reactor-http-nio-3] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=36
2025-06-09 20:49:37 [reactor-http-nio-3] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/14: id=69
2025-06-09 20:49:37 [reactor-http-nio-3] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=36
2025-06-09 20:49:41 [http-nio-8080-exec-6] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:49:41 [http-nio-8080-exec-6] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:49:41 [http-nio-8080-exec-5] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 20:49:41 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:52:24 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:52:24 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:52:24 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-09 20:52:24 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@87dc829]]
2025-06-09 20:52:24 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-09 20:52:31 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 20:52:31 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-09 20:52:31 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-09 20:52:33 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 72842 (/Users/andreyshelyagin/sql-opt/backend/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/sql-opt/backend)
2025-06-09 20:52:33 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-09 20:52:34 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-09 20:52:34 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 78 ms. Found 5 JPA repository interfaces.
2025-06-09 20:52:34 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-09 20:52:34 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-09 20:52:34 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-09 20:52:34 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-09 20:52:34 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 827 ms
2025-06-09 20:52:34 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-09 20:52:34 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@5203c80f
2025-06-09 20:52:34 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-09 20:52:34 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-09 20:52:34 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-09 20:52:34 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-09 20:52:34 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-09 20:52:34 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-09 20:52:34 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.013s)
2025-06-09 20:52:34 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 3
2025-06-09 20:52:34 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-09 20:52:34 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-09 20:52:34 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-09 20:52:34 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-09 20:52:34 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-09 20:52:34 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-09 20:52:35 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 20:52:35 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-09 20:52:35 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-09 20:52:36 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-09 20:52:36 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-09 20:52:36 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-09 20:52:36 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-09 20:52:36 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-09 20:52:36 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@3ea95c22]]
2025-06-09 20:52:36 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-09 20:52:36 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 3.257 seconds (process running for 3.677)
2025-06-09 20:52:39 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-09 20:52:39 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-09 20:52:39 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-09 20:52:39 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:52:48 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:52:48 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:52:55 [http-nio-8080-exec-6] INFO  c.e.b.controller.AuthController - User logged in successfully: username=andrey
2025-06-09 20:52:55 [http-nio-8080-exec-7] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 20:52:55 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:52:59 [http-nio-8080-exec-5] INFO  c.e.backend.service.ChatService - Created chat: id=15, title=Chat 15
2025-06-09 20:52:59 [http-nio-8080-exec-10] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:52:59 [http-nio-8080-exec-10] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:52:59 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:53:00 [http-nio-8080-exec-6] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=15, query=select * from my_db, llm=Local
2025-06-09 20:53:00 [http-nio-8080-exec-6] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-09 20:53:00 [http-nio-8080-exec-6] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=15, query=select * from my_db, llm=Local
2025-06-09 20:53:00 [http-nio-8080-exec-6] INFO  c.e.backend.service.ChatService - Processing sendMessage: chatId=15, userId=1, content=select * from my_db
2025-06-09 20:53:00 [http-nio-8080-exec-6] INFO  c.e.backend.service.ChatService - Message saved successfully: id=71
2025-06-09 20:53:00 [http-nio-8080-exec-6] INFO  c.e.b.service.SqlOptimizationService - Successfully sent user message through ChatService: id=70
2025-06-09 20:53:10 [http-nio-8080-exec-6] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=37
2025-06-09 20:53:10 [http-nio-8080-exec-6] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/15: id=72
2025-06-09 20:53:10 [http-nio-8080-exec-6] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=37
2025-06-09 20:53:15 [http-nio-8080-exec-7] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:53:15 [http-nio-8080-exec-7] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:53:15 [http-nio-8080-exec-10] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 20:53:15 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:53:16 [http-nio-8080-exec-6] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:53:16 [http-nio-8080-exec-6] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:53:17 [http-nio-8080-exec-7] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 20:53:17 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:53:18 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:53:18 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:53:18 [http-nio-8080-exec-6] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 20:53:18 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:53:36 [MessageBroker-1] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 6 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(6)-CONNECTED(6)-DISCONNECT(1)], stompBrokerRelay[null], inboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 57], outboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 13], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 2]
2025-06-09 20:54:34 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:54:34 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:54:34 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-09 20:54:34 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@3ea95c22]]
2025-06-09 20:54:34 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-09 20:54:39 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 20:54:39 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-09 20:54:39 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-09 20:54:40 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 73280 (/Users/andreyshelyagin/sql-opt/backend/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/sql-opt/backend)
2025-06-09 20:54:40 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-09 20:54:41 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-09 20:54:41 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 73 ms. Found 5 JPA repository interfaces.
2025-06-09 20:54:41 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-09 20:54:41 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-09 20:54:41 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-09 20:54:41 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-09 20:54:41 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 823 ms
2025-06-09 20:54:41 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-09 20:54:41 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@539fc5d1
2025-06-09 20:54:41 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-09 20:54:41 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-09 20:54:41 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-09 20:54:41 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-09 20:54:41 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-09 20:54:41 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-09 20:54:41 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.011s)
2025-06-09 20:54:41 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 3
2025-06-09 20:54:41 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-09 20:54:41 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-09 20:54:41 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-09 20:54:42 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-09 20:54:42 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-09 20:54:42 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-09 20:54:42 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 20:54:42 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-09 20:54:42 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-09 20:54:43 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-09 20:54:43 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-09 20:54:43 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-09 20:54:43 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-09 20:54:43 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-09 20:54:43 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@791a5c5a]]
2025-06-09 20:54:43 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-09 20:54:43 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 3.129 seconds (process running for 3.412)
2025-06-09 20:54:44 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-09 20:54:44 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-09 20:54:44 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-06-09 20:54:44 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:55:00 [http-nio-8080-exec-4] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:55:00 [http-nio-8080-exec-4] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:55:05 [http-nio-8080-exec-5] INFO  c.e.b.controller.AuthController - User logged in successfully: username=andrey
2025-06-09 20:55:05 [http-nio-8080-exec-6] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 20:55:05 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:55:09 [http-nio-8080-exec-4] INFO  c.e.backend.service.ChatService - Created chat: id=16, title=Chat 16
2025-06-09 20:55:09 [http-nio-8080-exec-9] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:55:09 [http-nio-8080-exec-9] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:55:09 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:55:10 [http-nio-8080-exec-5] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=16, query=select * from my_db, llm=Local
2025-06-09 20:55:10 [http-nio-8080-exec-5] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-09 20:55:10 [http-nio-8080-exec-5] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=16, query=select * from my_db, llm=Local
2025-06-09 20:55:25 [http-nio-8080-exec-5] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=38
2025-06-09 20:55:25 [http-nio-8080-exec-5] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/16: id=74
2025-06-09 20:55:25 [http-nio-8080-exec-5] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=38
2025-06-09 20:55:41 [http-nio-8080-exec-1] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:55:41 [http-nio-8080-exec-1] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:55:41 [http-nio-8080-exec-8] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 20:55:41 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:55:43 [http-nio-8080-exec-9] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:55:43 [http-nio-8080-exec-9] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:55:43 [MessageBroker-1] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 4 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(4)-CONNECTED(4)-DISCONNECT(1)], stompBrokerRelay[null], inboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 45], outboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 10], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 2]
2025-06-09 20:55:43 [http-nio-8080-exec-7] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 20:55:43 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:55:46 [http-nio-8080-exec-6] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=16, query=select * from my_db, llm=GigaChat
2025-06-09 20:55:46 [http-nio-8080-exec-6] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-09 20:55:46 [http-nio-8080-exec-6] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=16, query=select * from my_db, llm=GigaChat
2025-06-09 20:55:46 [http-nio-8080-exec-6] INFO  c.e.b.service.GigaChatAuthService - Attempting to authenticate with GigaChat API
2025-06-09 20:55:48 [reactor-http-nio-2] INFO  c.e.b.service.GigaChatAuthService - Successfully refreshed GigaChat token, expires in 3600 seconds
2025-06-09 20:55:49 [reactor-http-nio-2] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=39
2025-06-09 20:55:49 [reactor-http-nio-2] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/16: id=76
2025-06-09 20:55:49 [reactor-http-nio-2] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=39
2025-06-09 20:55:53 [http-nio-8080-exec-7] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:55:53 [http-nio-8080-exec-7] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:55:53 [http-nio-8080-exec-1] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 20:55:54 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 20:58:40 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 20:58:40 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 20:58:40 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-09 20:58:40 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@791a5c5a]]
2025-06-09 20:58:40 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-09 20:58:48 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 20:58:48 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-09 20:58:48 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-09 21:21:32 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 78361 (/Users/andreyshelyagin/sql-opt/backend/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/sql-opt/backend)
2025-06-09 21:21:32 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-09 21:21:33 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-09 21:21:33 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 87 ms. Found 5 JPA repository interfaces.
2025-06-09 21:21:34 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-09 21:21:34 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-09 21:21:34 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-09 21:21:34 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-09 21:21:34 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1216 ms
2025-06-09 21:21:34 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-09 21:21:34 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@147e0734
2025-06-09 21:21:34 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-09 21:21:34 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-09 21:21:34 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-09 21:21:34 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-09 21:21:34 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-09 21:21:34 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-09 21:21:34 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.012s)
2025-06-09 21:21:34 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 3
2025-06-09 21:21:34 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-09 21:21:34 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-09 21:21:34 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-09 21:21:34 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-09 21:21:34 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-09 21:21:34 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-09 21:21:35 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-06-09 21:21:35 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - constraint "uk_i418m0m7mf9lmh4tls58ci0i9" of relation "sql_queries" does not exist, skipping
2025-06-09 21:21:35 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-06-09 21:21:35 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - constraint "uk_6dotkott2kjsp8vw4d0m25fb7" of relation "users" does not exist, skipping
2025-06-09 21:21:35 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-06-09 21:21:35 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - constraint "uk_r43af9ap4edm43mmtq01oddj6" of relation "users" does not exist, skipping
2025-06-09 21:21:35 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 21:21:35 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-09 21:21:35 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-09 21:21:36 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-09 21:21:36 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-09 21:21:36 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-09 21:21:36 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-09 21:21:36 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-09 21:21:36 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@289f9094]]
2025-06-09 21:21:36 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-09 21:21:36 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 4.216 seconds (process running for 5.122)
2025-06-09 21:21:39 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-09 21:21:39 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-09 21:21:39 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-09 21:21:39 [http-nio-8080-exec-3] WARN  c.e.b.config.WebSocketMessageHandler - WebSocket authentication failed: null authentication
2025-06-09 21:21:39 [clientOutboundChannel-1] ERROR o.s.w.s.m.StompSubProtocolHandler - Error publishing SessionConnectedEvent[GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={Authorization=[Bearer eyJhbGciOiJIUzM4NCJ9.eyJzdWIiOiJhbmRyZXkiLCJjcmVhdGVkIjoxNzQ5NDgwOTA1NTkyLCJpYXQiOjE3NDk0ODA5MDUsImV4cCI6MTc0OTU2NzMwNX0.Wjgnc_LTkXPxrvNKbk7iIV5ONZWgI1gPsgNZYs-NunrY33JMSEQ4Bc193f2NKzCq], accept-version=[1.2,1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={}, simpHeartbeat=[J@54eeb0ea, simpSessionId=mwuuiwf3}], simpHeartbeat=[J@7169bc86, simpSessionId=mwuuiwf3}]]
java.lang.NullPointerException: Cannot invoke "java.security.Principal.getName()" because the return value of "org.springframework.messaging.simp.stomp.StompHeaderAccessor.getUser()" is null
	at com.example.backend.config.WebSocketMessageHandler.handleWebSocketConnectListener(WebSocketMessageHandler.java:88)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.context.event.ApplicationListenerMethodAdapter.doInvoke(ApplicationListenerMethodAdapter.java:365)
	at org.springframework.context.event.ApplicationListenerMethodAdapter.processEvent(ApplicationListenerMethodAdapter.java:237)
	at org.springframework.context.event.ApplicationListenerMethodAdapter.onApplicationEvent(ApplicationListenerMethodAdapter.java:168)
	at org.springframework.context.event.SimpleApplicationEventMulticaster.doInvokeListener(SimpleApplicationEventMulticaster.java:185)
	at org.springframework.context.event.SimpleApplicationEventMulticaster.invokeListener(SimpleApplicationEventMulticaster.java:178)
	at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:156)
	at org.springframework.context.support.AbstractApplicationContext.publishEvent(AbstractApplicationContext.java:451)
	at org.springframework.context.support.AbstractApplicationContext.publishEvent(AbstractApplicationContext.java:384)
	at org.springframework.web.socket.messaging.StompSubProtocolHandler.publishEvent(StompSubProtocolHandler.java:448)
	at org.springframework.web.socket.messaging.StompSubProtocolHandler.handleMessageToClient(StompSubProtocolHandler.java:492)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.handleMessage(SubProtocolWebSocketHandler.java:386)
	at org.springframework.messaging.support.ExecutorSubscribableChannel$SendTask.run(ExecutorSubscribableChannel.java:152)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-06-09 21:21:57 [http-nio-8080-exec-6] ERROR c.e.b.controller.AuthController - Login failed: User not found
2025-06-09 21:21:59 [http-nio-8080-exec-7] ERROR c.e.b.controller.AuthController - Login failed: User not found
2025-06-09 21:22:22 [http-nio-8080-exec-10] INFO  c.e.b.controller.AuthController - User registered successfully: username=andrey
2025-06-09 21:22:22 [http-nio-8080-exec-2] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 21:22:24 [http-nio-8080-exec-6] INFO  c.e.backend.service.ChatService - Created chat: id=1, title=Chat 1
2025-06-09 21:22:24 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 21:22:36 [MessageBroker-1] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[2 current WS(2)-HttpStream(0)-HttpPoll(0), 2 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(2)-CONNECTED(2)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 18], outboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 3], sockJsScheduler[pool size = 6, active threads = 1, queued tasks = 1, completed tasks = 2]
2025-06-09 21:23:00 [http-nio-8080-exec-10] INFO  c.e.backend.service.ChatService - Processing sendMessage: chatId=1, userId=1, content=/Users/andreyshelyagin/Library/Java/JavaVirtualMachines/ms-21.0.7/Contents/Home/bin/java -XX:TieredStopAtLevel=1 -Dspring.output.ansi.enabled=always -Dcom.sun.management.jmxremote -Dspring.jmx.enabled=true -Dspring.liveBeansView.mbeanDomain -Dspring.application.admin.enabled=true -Dmanagement.endpoints.jmx.exposure.include=* -javaagent:/Applications/IntelliJ IDEA.app/Contents/lib/idea_rt.jar=51680:/Applications/IntelliJ IDEA.app/Contents/bin -Dfile.encoding=UTF-8 -Dsun.stdout.encoding=UTF-8 -Dsun.stderr.encoding=UTF-8 -classpath /Users/andreyshelyagin/sql-opt/backend/build/classes/java/main:/Users/andreyshelyagin/sql-opt/backend/build/resources/main:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.projectlombok/lombok/1.18.30/f195ee86e6c896ea47a1d39defbe20eb59cd149d/lombok-1.18.30.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework.boot/spring-boot-starter-websocket/3.2.3/343ca88da40fbd06b6d4b3d4b86fb1bdc5d80a09/spring-boot-starter-websocket-3.2.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework.boot/spring-boot-starter-web/3.2.3/bf2b775d4f4e6349129c64de30939a5493779706/spring-boot-starter-web-3.2.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework.boot/spring-boot-starter-data-jpa/3.2.3/1fd0770b23c57627e5a37726fb4060f5bfa4da6f/spring-boot-starter-data-jpa-3.2.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework.boot/spring-boot-starter-security/3.2.3/f6353a8e62be7372b3968ab71e613b5188d55c3b/spring-boot-starter-security-3.2.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework.boot/spring-boot-starter-validation/3.2.3/6bb79fe1a0760b5cec37bd85e31bd4cc987c8185/spring-boot-starter-validation-3.2.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework.boot/spring-boot-starter-webflux/3.2.3/94ced38f4b6b089d9708a5e7831ad182a88546fb/spring-boot-starter-webflux-3.2.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.flywaydb/flyway-core/9.22.3/76519923a547892f0108b99d1e7b06dcb4727ecd/flyway-core-9.22.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/com.zaxxer/HikariCP/5.0.1/a74c7f0a37046846e88d54f7cb6ea6d565c65f9c/HikariCP-5.0.1.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.jsonwebtoken/jjwt-api/0.12.3/30b7de9176d17fa347eef14b85480825dab76b58/jjwt-api-0.12.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/com.github.jsqlparser/jsqlparser/4.6/a4d1bda17df913c8b3ff12d39e35e9efd3a4e01f/jsqlparser-4.6.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springdoc/springdoc-openapi-starter-webmvc-ui/2.3.0/b4af31e9d40539c94f8debbf760134d961333c24/springdoc-openapi-starter-webmvc-ui-2.3.0.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springdoc/springdoc-openapi-starter-webmvc-api/2.3.0/e8e6e46e2b7875c1789782d3820536bb2d868b17/springdoc-openapi-starter-webmvc-api-2.3.0.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/jakarta.annotation/jakarta.annotation-api/2.1.1/48b9bda22b091b1f48b13af03fe36db3be6e1ae3/jakarta.annotation-api-2.1.1.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/jakarta.servlet/jakarta.servlet-api/6.0.0/abecc699286e65035ebba9844c03931357a6a963/jakarta.servlet-api-6.0.0.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.apache.commons/commons-lang3/3.13.0/b7263237aa89c1f99b327197c41d0669707a462e/commons-lang3-3.13.0.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.netty/netty-resolver-dns-native-macos/4.1.107.Final/93db846854c5dbcf3f7690049da954b9a2decc2e/netty-resolver-dns-native-macos-4.1.107.Final-osx-aarch_64.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.netty/netty-resolver-dns-native-macos/4.1.107.Final/ca071cb93bd52f4193a980158b97e3d068d22d18/netty-resolver-dns-native-macos-4.1.107.Final-osx-x86_64.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework/spring-websocket/6.1.4/832c5e6284406c95c8c126800488f60c6445094a/spring-websocket-6.1.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework/spring-messaging/6.1.4/6de5be83e0772acb48221b895f1d2324d1db500f/spring-messaging-6.1.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework.boot/spring-boot-starter-json/3.2.3/c71ec683425f09b7a213358d3b22959d929d1108/spring-boot-starter-json-3.2.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework.boot/spring-boot-starter/3.2.3/15f3e03b0fd9570f90bdce9651610cc152534cf4/spring-boot-starter-3.2.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework.boot/spring-boot-starter-tomcat/3.2.3/ac392404d41766194b8fce6834c71879f9e8f479/spring-boot-starter-tomcat-3.2.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework/spring-webmvc/6.1.4/e7aad7c53e05c8772209e915029e121262a7bc33/spring-webmvc-6.1.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework/spring-web/6.1.4/b237532e03330a7cf8f66dc147e62bbbe44c702f/spring-web-6.1.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework.boot/spring-boot-starter-jdbc/3.2.3/4c3632af95417c28c45342b08353ccaecaacbf3/spring-boot-starter-jdbc-3.2.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework.boot/spring-boot-starter-aop/3.2.3/db8d799efd6cacd3bd134d471c3f983cbc1a137/spring-boot-starter-aop-3.2.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework.data/spring-data-jpa/3.2.3/ae734906f5fb1e1892da7ab48acb6d0e0d407673/spring-data-jpa-3.2.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.hibernate.orm/hibernate-core/6.4.4.Final/5c9decb3c5a70bf7801d41fc32633416c26be069/hibernate-core-6.4.4.Final.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework/spring-aspects/6.1.4/2b1b5c0f9f639d0317b9f7c20c07f90b49fee6fb/spring-aspects-6.1.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework.security/spring-security-web/6.2.2/ad30f4614a6e88a1ac7e0b1e701d950d7bcda143/spring-security-web-6.2.2.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework.security/spring-security-config/6.2.2/e1e3d332d9268aca2ce321be73215222f9a721f/spring-security-config-6.2.2.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework/spring-aop/6.1.4/26ae2c9e7f69b0235a2faca1c58416c51eaebef6/spring-aop-6.1.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.apache.tomcat.embed/tomcat-embed-el/10.1.19/c61a582c391aca130884a5421deedfe1a96c7415/tomcat-embed-el-10.1.19.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.hibernate.validator/hibernate-validator/8.0.1.Final/e49e116b3d3928060599b176b3538bb848718e95/hibernate-validator-8.0.1.Final.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework.boot/spring-boot-starter-reactor-netty/3.2.3/558d5d87aaae97cfa954232192211a1243641cc1/spring-boot-starter-reactor-netty-3.2.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework/spring-webflux/6.1.4/c559d4e0c44a735dc4fcd09bed6e7981903f9e0a/spring-webflux-6.1.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/com.fasterxml.jackson.dataformat/jackson-dataformat-toml/2.15.4/4dde0126d9484603cd1b98e9654827697e16fce/jackson-dataformat-toml-2.15.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/com.google.code.gson/gson/2.10.1/b3add478d4382b78ea20b1671390a858002feb6c/gson-2.10.1.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.slf4j/slf4j-api/2.0.12/48f109a2a6d8f446c794f3e3fa0d86df0cdfa312/slf4j-api-2.0.12.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.webjars/swagger-ui/5.10.3/744ae2862cc79c137020f2ce6e07de2f1d6a2657/swagger-ui-5.10.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springdoc/springdoc-openapi-starter-common/2.3.0/acf3654082b3e000d5b59cc9733227702aa57f75/springdoc-openapi-starter-common-2.3.0.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.netty/netty-resolver-dns-classes-macos/4.1.107.Final/eb069de9b8621a42e7c1843c5f21c7a86e943e0f/netty-resolver-dns-classes-macos-4.1.107.Final.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework/spring-context/6.1.4/765316bef55e41e4523f9b2780b8721ce5dd0fe2/spring-context-6.1.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework/spring-core/6.1.4/3b4dde8f55c3d5d4e948de64b866d7bb27e5a8d4/spring-core-6.1.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework/spring-beans/6.1.4/e311cc9937d522a1051622580b4a2c250fc74164/spring-beans-6.1.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/com.fasterxml.jackson.datatype/jackson-datatype-jdk8/2.15.4/694777f182334a21bf1aeab1b04cc4398c801f3f/jackson-datatype-jdk8-2.15.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/com.fasterxml.jackson.datatype/jackson-datatype-jsr310/2.15.4/7de629770a4559db57128d35ccae7d2fddd35db3/jackson-datatype-jsr310-2.15.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/com.fasterxml.jackson.module/jackson-module-parameter-names/2.15.4/e654497a08359db2521b69b5f710e00836915d8c/jackson-module-parameter-names-2.15.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/com.fasterxml.jackson.core/jackson-databind/2.15.4/560309fc381f77d4d15c4a4cdaa0db5025c4fd13/jackson-databind-2.15.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework.boot/spring-boot-autoconfigure/3.2.3/59db74eb4196885bb5a149417ab1ab51dc9b6952/spring-boot-autoconfigure-3.2.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework.boot/spring-boot/3.2.3/b4aa6e3fdc4078fee4a4b9d702d9cc64e3fad1d4/spring-boot-3.2.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework.boot/spring-boot-starter-logging/3.2.3/c186015229d7f5cbd30ea99bf903a8cede6d849f/spring-boot-starter-logging-3.2.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.yaml/snakeyaml/2.2/3af797a25458550a16bf89acc8e4ab2b7f2bfce0/snakeyaml-2.2.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.apache.tomcat.embed/tomcat-embed-websocket/10.1.19/adf4710fac2471236f8a466ca678cdf7e6a8257c/tomcat-embed-websocket-10.1.19.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.apache.tomcat.embed/tomcat-embed-core/10.1.19/3dbbca8acbd4dd6a137c3d6f934a2931512b42ce/tomcat-embed-core-10.1.19.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework/spring-expression/6.1.4/a1f2e3af83c7222b7f95f68a8e0666fdcceb35e1/spring-expression-6.1.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.micrometer/micrometer-observation/1.12.3/105f768c211564fcebe4d79419bda4ebef0d0ac7/micrometer-observation-1.12.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework/spring-jdbc/6.1.4/4e9ac0b228f11a90f6bc647276fdffa7ac0f12fe/spring-jdbc-6.1.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.aspectj/aspectjweaver/1.9.21/beaabaea95c7f3330f415c72ee0ffe79b51d172f/aspectjweaver-1.9.21.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework.data/spring-data-commons/3.2.3/9b09afa13803c321e4b72ef5448e0d93d9f8ca18/spring-data-commons-3.2.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework/spring-orm/6.1.4/d8119336a38cba3e794bfec7761e2690056affe0/spring-orm-6.1.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework/spring-tx/6.1.4/7179b3c7febc0514556ea4e3f1613cacb358078d/spring-tx-6.1.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.antlr/antlr4-runtime/4.13.0/5a02e48521624faaf5ff4d99afc88b01686af655/antlr4-runtime-4.13.0.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/jakarta.persistence/jakarta.persistence-api/3.1.0/66901fa1c373c6aff65c13791cc11da72060a8d6/jakarta.persistence-api-3.1.0.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/jakarta.transaction/jakarta.transaction-api/2.0.1/51a520e3fae406abb84e2e1148e6746ce3f80a1a/jakarta.transaction-api-2.0.1.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework.security/spring-security-core/6.2.2/8cf7e96179c6f253ab36f76ebb24538a7e619f49/spring-security-core-6.2.2.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/jakarta.validation/jakarta.validation-api/3.0.2/92b6631659ba35ca09e44874d3eb936edfeee532/jakarta.validation-api-3.0.2.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.jboss.logging/jboss-logging/3.5.3.Final/c88fc1d8a96d4c3491f55d4317458ccad53ca663/jboss-logging-3.5.3.Final.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/com.fasterxml/classmate/1.6.0/91affab6f84a2182fce5dd72a8d01bc14346dddd/classmate-1.6.0.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.projectreactor.netty/reactor-netty-http/1.1.16/a1be57535c8bdd2ae9d35d8bcf699fafe6de02e6/reactor-netty-http-1.1.16.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.projectreactor/reactor-core/3.6.3/f8e14cecf387099ed72c3b141a60908f701ae8b0/reactor-core-3.6.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/com.fasterxml.jackson.core/jackson-core/2.15.4/aebe84b45360debad94f692a4074c6aceb535fa0/jackson-core-2.15.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.swagger.core.v3/swagger-core-jakarta/2.2.19/1bbc09fba4c0ac2375da7563cb03dfd0f3e07100/swagger-core-jakarta-2.2.19.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.netty/netty-resolver-dns/4.1.107.Final/d655d09e972dee46f580dbcf41c0d1356aea9e1b/netty-resolver-dns-4.1.107.Final.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.netty/netty-transport-native-unix-common/4.1.107.Final/4d61d4959741109b3eccd7337f11fc89fa90a74a/netty-transport-native-unix-common-4.1.107.Final.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.netty/netty-common/4.1.107.Final/4f17a547530d64becd7179507b25f4154bcfba57/netty-common-4.1.107.Final.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework/spring-jcl/6.1.4/a244bd674a5431dfdce68d28cdf857104e6fff67/spring-jcl-6.1.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/com.fasterxml.jackson.core/jackson-annotations/2.15.4/5223ea5a9bf52cdc9c5e537a0e52f2432eaf208b/jackson-annotations-2.15.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/ch.qos.logback/logback-classic/1.4.14/d98bc162275134cdf1518774da4a2a17ef6fb94d/logback-classic-1.4.14.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.apache.logging.log4j/log4j-to-slf4j/2.21.1/d77b2ba81711ed596cd797cc2b5b5bd7409d841c/log4j-to-slf4j-2.21.1.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.slf4j/jul-to-slf4j/2.0.12/eb5f48f782b41cc881b0bf1fb4d88ae2ff6d5b93/jul-to-slf4j-2.0.12.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.micrometer/micrometer-commons/1.12.3/83add2dda5cdc811fefb83e858c7412a176fe5b1/micrometer-commons-1.12.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.springframework.security/spring-security-crypto/6.2.2/bd1b47ce6593b4d66a1f12e023b59dacc00db00a/spring-security-crypto-6.2.2.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.projectreactor.netty/reactor-netty-core/1.1.16/cf9af9296b92100cfe8284fe262fce4b493dcde5/reactor-netty-core-1.1.16.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.netty/netty-transport-native-epoll/4.1.107.Final/2df4e2533a4c0dd124ac06b03d606e790dc7f9af/netty-transport-native-epoll-4.1.107.Final-linux-x86_64.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.netty/netty-codec-http2/4.1.107.Final/3885ffe7dd05c9773df70c61009f34a5a8a383ec/netty-codec-http2-4.1.107.Final.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.netty/netty-codec-http/4.1.107.Final/4d8e9e51b7254bd26a42fe17bdcae32e4c6ebb3/netty-codec-http-4.1.107.Final.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.reactivestreams/reactive-streams/1.0.4/3864a1320d97d7b045f729a326e1e077661f31b7/reactive-streams-1.0.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/com.fasterxml.jackson.dataformat/jackson-dataformat-yaml/2.15.4/4a5dcae45b67fe5edbec821711555d30347f69a0/jackson-dataformat-yaml-2.15.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.swagger.core.v3/swagger-models-jakarta/2.2.19/72b8a8ba29654ba31d951311081c33d464cee138/swagger-models-jakarta-2.2.19.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.swagger.core.v3/swagger-annotations-jakarta/2.2.19/c180d87c78d367771bbd954ebceba1b6c576fb52/swagger-annotations-jakarta-2.2.19.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/jakarta.xml.bind/jakarta.xml.bind-api/4.0.1/ca2330866cbc624c7e5ce982e121db1125d23e15/jakarta.xml.bind-api-4.0.1.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.netty/netty-handler/4.1.107.Final/d4c6b05f4d9aca117981297fb7f02953102ebb5e/netty-handler-4.1.107.Final.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.netty/netty-codec-dns/4.1.107.Final/945e8ad5ab7ec4f11fb0257d2594af0cfae1d4b7/netty-codec-dns-4.1.107.Final.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.netty/netty-codec/4.1.107.Final/a1d32debf2ed07c5852ab5b2904c43adb76c39e/netty-codec-4.1.107.Final.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.netty/netty-transport/4.1.107.Final/d6a105c621b47d1410e0e09419d7209d2d46e914/netty-transport-4.1.107.Final.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.netty/netty-buffer/4.1.107.Final/8509a72b8a5a2d33d611e99254aed39765c3ad82/netty-buffer-4.1.107.Final.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.netty/netty-resolver/4.1.107.Final/dfee84308341a42131dd0f8ac0e1e02d627c19f3/netty-resolver-4.1.107.Final.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/ch.qos.logback/logback-core/1.4.14/4d3c2248219ac0effeb380ed4c5280a80bf395e8/logback-core-1.4.14.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.apache.logging.log4j/log4j-api/2.21.1/74c65e87b9ce1694a01524e192d7be989ba70486/log4j-api-2.21.1.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.netty/netty-handler-proxy/4.1.107.Final/ebc495e9b2bc2c9ab60a264b40f62dc0671d9f6e/netty-handler-proxy-4.1.107.Final.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.netty/netty-transport-classes-epoll/4.1.107.Final/9234407d6a46745599735765c4d3755c7fc84162/netty-transport-classes-epoll-4.1.107.Final.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/jakarta.activation/jakarta.activation-api/2.1.2/640c0d5aff45dbff1e1a1bc09673ff3a02b1ba12/jakarta.activation-api-2.1.2.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.netty/netty-codec-socks/4.1.107.Final/3b7070e9acfe262bb0bd936c4051116631796b3b/netty-codec-socks-4.1.107.Final.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.jsonwebtoken/jjwt-impl/0.12.3/e850d2b3f53bd82355cd9ee1c471054aa602b320/jjwt-impl-0.12.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.jsonwebtoken/jjwt-jackson/0.12.3/5e6d0e45441547d892d3273a4ce5dd042e91d162/jjwt-jackson-0.12.3.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.postgresql/postgresql/42.6.1/aded708fdd722a277ebce49c29c3c6fa0703420/postgresql-42.6.1.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.checkerframework/checker-qual/3.31.0/eeefd4af42e2f4221d145c1791582f91868f99ab/checker-qual-3.31.0.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.hibernate.common/hibernate-commons-annotations/6.0.6.Final/77a5f94b56d49508e0ee334751db5b78e5ccd50c/hibernate-commons-annotations-6.0.6.Final.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/io.smallrye/jandex/3.1.2/a6c1c89925c7df06242b03dddb353116ceb9584c/jandex-3.1.2.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/net.bytebuddy/byte-buddy/1.14.12/6e37f743dc15a8d7a4feb3eb0025cbc612d5b9e1/byte-buddy-1.14.12.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.glassfish.jaxb/jaxb-runtime/4.0.4/7180c50ef8bd127bb1dd645458b906cffcf6c2b5/jaxb-runtime-4.0.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/jakarta.inject/jakarta.inject-api/2.0.1/4c28afe1991a941d7702fe1362c365f0a8641d1e/jakarta.inject-api-2.0.1.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.glassfish.jaxb/jaxb-core/4.0.4/2d5aadd02af86f1e9d8c6f7e8501673f915d4e25/jaxb-core-4.0.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.eclipse.angus/angus-activation/2.0.1/eaafaf4eb71b400e4136fc3a286f50e34a68ecb7/angus-activation-2.0.1.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/org.glassfish.jaxb/txw2/4.0.4/cfd2bcf08782673ac370694fdf2cf76dbaa607ef/txw2-4.0.4.jar:/Users/andreyshelyagin/.gradle/caches/modules-2/files-2.1/com.sun.istack/istack-commons-runtime/4.1.2/18ec117c85f3ba0ac65409136afa8e42bc74e739/istack-commons-runtime-4.1.2.jar com.example.backend.BackendApplication

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.3)

2025-06-09 21:21:32 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 78361 (/Users/andreyshelyagin/sql-opt/backend/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/sql-opt/backend)
2025-06-09 21:21:32 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-09 21:21:33 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-09 21:21:33 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 87 ms. Found 5 JPA repository interfaces.
2025-06-09 21:21:34 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-09 21:21:34 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-09 21:21:34 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-09 21:21:34 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-09 21:21:34 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1216 ms
2025-06-09 21:21:34 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-09 21:21:34 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@147e0734
2025-06-09 21:21:34 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-09 21:21:34 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-09 21:21:34 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-09 21:21:34 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-09 21:21:34 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-09 21:21:34 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-09 21:21:34 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.012s)
2025-06-09 21:21:34 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 3
2025-06-09 21:21:34 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-09 21:21:34 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-09 21:21:34 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-09 21:21:34 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-09 21:21:34 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-09 21:21:34 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-09 21:21:35 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-06-09 21:21:35 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - constraint "uk_i418m0m7mf9lmh4tls58ci0i9" of relation "sql_queries" does not exist, skipping
2025-06-09 21:21:35 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-06-09 21:21:35 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - constraint "uk_6dotkott2kjsp8vw4d0m25fb7" of relation "users" does not exist, skipping
2025-06-09 21:21:35 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-06-09 21:21:35 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - constraint "uk_r43af9ap4edm43mmtq01oddj6" of relation "users" does not exist, skipping
2025-06-09 21:21:35 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 21:21:35 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-09 21:21:35 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-09 21:21:36 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-09 21:21:36 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-09 21:21:36 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-09 21:21:36 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-09 21:21:36 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-09 21:21:36 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@289f9094]]
2025-06-09 21:21:36 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-09 21:21:36 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 4.216 seconds (process running for 5.122)
2025-06-09 21:21:39 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-09 21:21:39 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-09 21:21:39 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-09 21:21:39 [http-nio-8080-exec-3] WARN  c.e.b.config.WebSocketMessageHandler - WebSocket authentication failed: null authentication
2025-06-09 21:21:39 [clientOutboundChannel-1] ERROR o.s.w.s.m.StompSubProtocolHandler - Error publishing SessionConnectedEvent[GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT_ACK, simpConnectMessage=GenericMessage [payload=byte[0], headers={simpMessageType=CONNECT, stompCommand=CONNECT, nativeHeaders={Authorization=[Bearer eyJhbGciOiJIUzM4NCJ9.eyJzdWIiOiJhbmRyZXkiLCJjcmVhdGVkIjoxNzQ5NDgwOTA1NTkyLCJpYXQiOjE3NDk0ODA5MDUsImV4cCI6MTc0OTU2NzMwNX0.Wjgnc_LTkXPxrvNKbk7iIV5ONZWgI1gPsgNZYs-NunrY33JMSEQ4Bc193f2NKzCq], accept-version=[1.2,1.1,1.0], heart-beat=[10000,10000]}, simpSessionAttributes={}, simpHeartbeat=[J@54eeb0ea, simpSessionId=mwuuiwf3}], simpHeartbeat=[J@7169bc86, simpSessionId=mwuuiwf3}]]
java.lang.NullPointerException: Cannot invoke "java.security.Principal.getName()" because the return value of "org.springframework.messaging.simp.stomp.StompHeaderAccessor.getUser()" is null
	at com.example.backend.config.WebSocketMessageHandler.handleWebSocketConnectListener(WebSocketMessageHandler.java:88)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.context.event.ApplicationListenerMethodAdapter.doInvoke(ApplicationListenerMethodAdapter.java:365)
	at org.springframework.context.event.ApplicationListenerMethodAdapter.processEvent(ApplicationListenerMethodAdapter.java:237)
	at org.springframework.context.event.ApplicationListenerMethodAdapter.onApplicationEvent(ApplicationListenerMethodAdapter.java:168)
	at org.springframework.context.event.SimpleApplicationEventMulticaster.doInvokeListener(SimpleApplicationEventMulticaster.java:185)
	at org.springframework.context.event.SimpleApplicationEventMulticaster.invokeListener(SimpleApplicationEventMulticaster.java:178)
	at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:156)
	at org.springframework.context.support.AbstractApplicationContext.publishEvent(AbstractApplicationContext.java:451)
	at org.springframework.context.support.AbstractApplicationContext.publishEvent(AbstractApplicationContext.java:384)
	at org.springframework.web.socket.messaging.StompSubProtocolHandler.publishEvent(StompSubProtocolHandler.java:448)
	at org.springframework.web.socket.messaging.StompSubProtocolHandler.handleMessageToClient(StompSubProtocolHandler.java:492)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.handleMessage(SubProtocolWebSocketHandler.java:386)
	at org.springframework.messaging.support.ExecutorSubscribableChannel$SendTask.run(ExecutorSubscribableChannel.java:152)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-06-09 21:21:57 [http-nio-8080-exec-6] ERROR c.e.b.controller.AuthController - Login failed: User not found
2025-06-09 21:21:59 [http-nio-8080-exec-7] ERROR c.e.b.controller.AuthController - Login failed: User not found
2025-06-09 21:23:00 [http-nio-8080-exec-10] INFO  c.e.backend.service.ChatService - Message saved successfully: id=1
2025-06-09 21:23:00 [http-nio-8080-exec-10] INFO  c.e.backend.service.ChatService - Successfully sent message to /topic/chat/1: id=1
2025-06-09 21:23:00 [http-nio-8080-exec-10] INFO  c.e.b.controller.ChatController - Message sent successfully: chatId=1, messageId=1
2025-06-09 21:23:00 [http-nio-8080-exec-9] INFO  c.e.backend.service.ChatService - Processing sendMessage: chatId=1, userId=1, content=Пожалуйста, отправьте SQL запрос для оптимизации
2025-06-09 21:23:00 [http-nio-8080-exec-9] INFO  c.e.backend.service.ChatService - Message saved successfully: id=2
2025-06-09 21:23:00 [http-nio-8080-exec-9] INFO  c.e.backend.service.ChatService - Successfully sent message to /topic/chat/1: id=2
2025-06-09 21:23:00 [http-nio-8080-exec-9] INFO  c.e.b.controller.ChatController - Message sent successfully: chatId=1, messageId=2
2025-06-09 21:23:09 [http-nio-8080-exec-3] INFO  c.e.backend.service.ChatService - Deleted chat: chatId=1
2025-06-09 21:23:09 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 21:23:09 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 21:23:10 [http-nio-8080-exec-6] INFO  c.e.backend.service.ChatService - Created chat: id=2, title=Chat 1
2025-06-09 21:23:10 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 21:25:06 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 21:25:06 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 21:25:06 [SpringApplicationShutdownHook] ERROR o.s.w.s.m.StompSubProtocolHandler - Error publishing SessionDisconnectEvent[sessionId=mwuuiwf3, CloseStatus[code=1001, reason=null]]
java.lang.NullPointerException: Cannot invoke "java.security.Principal.getName()" because the return value of "org.springframework.messaging.simp.stomp.StompHeaderAccessor.getUser()" is null
	at com.example.backend.config.WebSocketMessageHandler.handleWebSocketDisconnectListener(WebSocketMessageHandler.java:95)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.context.event.ApplicationListenerMethodAdapter.doInvoke(ApplicationListenerMethodAdapter.java:365)
	at org.springframework.context.event.ApplicationListenerMethodAdapter.processEvent(ApplicationListenerMethodAdapter.java:237)
	at org.springframework.context.event.ApplicationListenerMethodAdapter.onApplicationEvent(ApplicationListenerMethodAdapter.java:168)
	at org.springframework.context.event.SimpleApplicationEventMulticaster.doInvokeListener(SimpleApplicationEventMulticaster.java:185)
	at org.springframework.context.event.SimpleApplicationEventMulticaster.invokeListener(SimpleApplicationEventMulticaster.java:178)
	at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:156)
	at org.springframework.context.support.AbstractApplicationContext.publishEvent(AbstractApplicationContext.java:451)
	at org.springframework.context.support.AbstractApplicationContext.publishEvent(AbstractApplicationContext.java:384)
	at org.springframework.web.socket.messaging.StompSubProtocolHandler.publishEvent(StompSubProtocolHandler.java:448)
	at org.springframework.web.socket.messaging.StompSubProtocolHandler.afterSessionEnded(StompSubProtocolHandler.java:683)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.clearSession(SubProtocolWebSocketHandler.java:551)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.afterConnectionClosed(SubProtocolWebSocketHandler.java:419)
	at org.springframework.web.socket.handler.WebSocketHandlerDecorator.afterConnectionClosed(WebSocketHandlerDecorator.java:85)
	at org.springframework.web.socket.handler.LoggingWebSocketHandlerDecorator.afterConnectionClosed(LoggingWebSocketHandlerDecorator.java:72)
	at org.springframework.web.socket.handler.ExceptionWebSocketHandlerDecorator.afterConnectionClosed(ExceptionWebSocketHandlerDecorator.java:78)
	at org.springframework.web.socket.sockjs.transport.session.AbstractSockJsSession.close(AbstractSockJsSession.java:200)
	at org.springframework.web.socket.handler.WebSocketSessionDecorator.close(WebSocketSessionDecorator.java:160)
	at org.springframework.web.socket.handler.ConcurrentWebSocketSessionDecorator.close(ConcurrentWebSocketSessionDecorator.java:271)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.stop(SubProtocolWebSocketHandler.java:307)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.stop(SubProtocolWebSocketHandler.java:320)
	at org.springframework.context.support.DefaultLifecycleProcessor.doStop(DefaultLifecycleProcessor.java:348)
	at org.springframework.context.support.DefaultLifecycleProcessor$LifecycleGroup.stop(DefaultLifecycleProcessor.java:487)
	at java.base/java.lang.Iterable.forEach(Iterable.java:75)
	at org.springframework.context.support.DefaultLifecycleProcessor.stopBeans(DefaultLifecycleProcessor.java:317)
	at org.springframework.context.support.DefaultLifecycleProcessor.onClose(DefaultLifecycleProcessor.java:218)
	at org.springframework.context.support.AbstractApplicationContext.doClose(AbstractApplicationContext.java:1136)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.doClose(ServletWebServerApplicationContext.java:174)
	at org.springframework.context.support.AbstractApplicationContext.close(AbstractApplicationContext.java:1090)
	at org.springframework.boot.SpringApplicationShutdownHook.closeAndWait(SpringApplicationShutdownHook.java:145)
	at java.base/java.lang.Iterable.forEach(Iterable.java:75)
	at org.springframework.boot.SpringApplicationShutdownHook.run(SpringApplicationShutdownHook.java:114)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-06-09 21:25:06 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-09 21:25:06 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@289f9094]]
2025-06-09 21:25:06 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-09 21:25:11 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 21:25:11 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-09 21:25:11 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-09 21:25:13 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 79122 (/Users/andreyshelyagin/sql-opt/backend/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/sql-opt/backend)
2025-06-09 21:25:13 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-09 21:25:13 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-09 21:25:14 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 75 ms. Found 5 JPA repository interfaces.
2025-06-09 21:25:14 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-09 21:25:14 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-09 21:25:14 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-09 21:25:14 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-09 21:25:14 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 793 ms
2025-06-09 21:25:14 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-09 21:25:14 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@7e94e331
2025-06-09 21:25:14 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-09 21:25:14 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-09 21:25:14 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-09 21:25:14 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-09 21:25:14 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-09 21:25:14 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-09 21:25:14 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.013s)
2025-06-09 21:25:14 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 3
2025-06-09 21:25:14 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-09 21:25:14 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-09 21:25:14 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-09 21:25:14 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-09 21:25:14 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-09 21:25:14 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-09 21:25:15 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 21:25:15 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-09 21:25:15 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-09 21:25:15 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-09 21:25:15 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-09 21:25:16 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-09 21:25:16 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-09 21:25:16 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-09 21:25:16 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@200eaca]]
2025-06-09 21:25:16 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-09 21:25:16 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 3.288 seconds (process running for 3.752)
2025-06-09 21:25:16 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-09 21:25:16 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-09 21:25:16 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-09 21:25:17 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 21:25:21 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 21:25:36 [http-nio-8080-exec-9] INFO  c.e.b.controller.AuthController - User logged in successfully: username=andrey
2025-06-09 21:25:36 [http-nio-8080-exec-10] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 21:25:36 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 21:26:16 [MessageBroker-2] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[3 current WS(3)-HttpStream(0)-HttpPoll(0), 3 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(3)-CONNECTED(3)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 33], outboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 6], sockJsScheduler[pool size = 7, active threads = 1, queued tasks = 1, completed tasks = 2]
2025-06-09 21:27:55 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 21:27:55 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 21:27:55 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 21:27:55 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 21:27:55 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 21:27:55 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 21:27:55 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-09 21:27:55 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@200eaca]]
2025-06-09 21:27:55 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-09 21:28:00 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 21:28:00 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-09 21:28:00 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-09 21:28:01 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 79840 (/Users/andreyshelyagin/sql-opt/backend/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/sql-opt/backend)
2025-06-09 21:28:01 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-09 21:28:02 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-09 21:28:02 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 80 ms. Found 5 JPA repository interfaces.
2025-06-09 21:28:02 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-09 21:28:02 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-09 21:28:02 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-09 21:28:02 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-09 21:28:02 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 801 ms
2025-06-09 21:28:02 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-09 21:28:02 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@7e94e331
2025-06-09 21:28:02 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-09 21:28:02 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-09 21:28:02 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-09 21:28:02 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-09 21:28:02 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-09 21:28:02 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-09 21:28:02 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.012s)
2025-06-09 21:28:02 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 3
2025-06-09 21:28:02 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-09 21:28:02 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-09 21:28:02 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-09 21:28:02 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-09 21:28:03 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-09 21:28:03 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-09 21:28:03 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 21:28:04 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-09 21:28:04 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-09 21:28:04 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-09 21:28:04 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-09 21:28:04 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-09 21:28:05 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-09 21:28:05 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-09 21:28:05 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@781f8d26]]
2025-06-09 21:28:05 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-09 21:28:05 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 3.377 seconds (process running for 3.782)
2025-06-09 21:28:05 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-09 21:28:05 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-09 21:28:05 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-06-09 21:28:05 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 21:28:05 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 21:28:05 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 21:28:05 [http-nio-8080-exec-1] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 21:28:05 [http-nio-8080-exec-1] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 21:28:06 [http-nio-8080-exec-3] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 21:28:06 [http-nio-8080-exec-3] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 21:28:07 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 21:28:07 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 21:28:11 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-09 21:28:11 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@781f8d26]]
2025-06-09 21:28:11 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-09 21:28:23 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 21:28:23 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-09 21:28:23 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-09 21:28:25 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 79934 (/Users/andreyshelyagin/sql-opt/backend/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/sql-opt/backend)
2025-06-09 21:28:25 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-09 21:28:25 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-09 21:28:25 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 96 ms. Found 5 JPA repository interfaces.
2025-06-09 21:28:26 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-09 21:28:26 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-09 21:28:26 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-09 21:28:26 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-09 21:28:26 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1001 ms
2025-06-09 21:28:26 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-09 21:28:26 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@2b01c689
2025-06-09 21:28:26 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-09 21:28:26 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-09 21:28:26 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-09 21:28:26 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-09 21:28:26 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-09 21:28:26 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-09 21:28:26 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.013s)
2025-06-09 21:28:26 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 3
2025-06-09 21:28:26 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-09 21:28:26 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-09 21:28:26 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-09 21:28:26 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-09 21:28:26 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-09 21:28:26 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-09 21:28:27 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 21:28:27 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-09 21:28:27 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-09 21:28:28 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-09 21:28:28 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-09 21:28:28 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-09 21:28:29 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-09 21:28:29 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-09 21:28:29 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@4a084cf0]]
2025-06-09 21:28:29 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-09 21:28:29 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 3.898 seconds (process running for 4.22)
2025-06-09 21:28:49 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-09 21:28:49 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-09 21:28:49 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-06-09 21:28:50 [http-nio-8080-exec-1] INFO  c.e.b.controller.AuthController - User logged in successfully: username=andrey
2025-06-09 21:28:50 [http-nio-8080-exec-2] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 21:28:50 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 21:29:01 [http-nio-8080-exec-10] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=2, query=select * from my_db, llm=Local
2025-06-09 21:29:01 [http-nio-8080-exec-10] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-09 21:29:01 [http-nio-8080-exec-10] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=2, query=select * from my_db, llm=Local, isMPP=false
2025-06-09 21:29:11 [http-nio-8080-exec-10] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=1
2025-06-09 21:29:11 [http-nio-8080-exec-10] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/2: id=4
2025-06-09 21:29:11 [http-nio-8080-exec-10] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=1
2025-06-09 21:29:29 [MessageBroker-1] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 1 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(1)-CONNECTED(1)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 9], outboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 2], sockJsScheduler[pool size = 5, active threads = 1, queued tasks = 1, completed tasks = 2]
2025-06-09 21:29:43 [http-nio-8080-exec-3] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=2, query=select * from my_db, llm=GigaChat
2025-06-09 21:29:43 [http-nio-8080-exec-3] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-09 21:29:43 [http-nio-8080-exec-3] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=2, query=select * from my_db, llm=GigaChat, isMPP=false
2025-06-09 21:29:43 [http-nio-8080-exec-3] INFO  c.e.b.service.GigaChatAuthService - Attempting to authenticate with GigaChat API
2025-06-09 21:29:45 [reactor-http-nio-2] INFO  c.e.b.service.GigaChatAuthService - Successfully refreshed GigaChat token, expires in 3600 seconds
2025-06-09 21:29:48 [reactor-http-nio-2] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=2
2025-06-09 21:29:48 [reactor-http-nio-2] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/2: id=6
2025-06-09 21:29:48 [reactor-http-nio-2] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=2
2025-06-09 21:30:21 [http-nio-8080-exec-8] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=2, query=select * from my_db, llm=GigaChat
2025-06-09 21:30:22 [http-nio-8080-exec-8] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-09 21:30:22 [http-nio-8080-exec-8] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=2, query=select * from my_db, llm=GigaChat, isMPP=false
2025-06-09 21:30:23 [reactor-http-nio-2] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=3
2025-06-09 21:30:23 [reactor-http-nio-2] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/2: id=8
2025-06-09 21:30:23 [reactor-http-nio-2] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=3
2025-06-09 21:33:23 [http-nio-8080-exec-8] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 21:33:23 [http-nio-8080-exec-8] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 21:33:26 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-09 21:33:26 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@4a084cf0]]
2025-06-09 21:33:26 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-09 21:33:41 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 81010 (/Users/andreyshelyagin/sql-opt/backend/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/sql-opt/backend)
2025-06-09 21:33:41 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-09 21:33:41 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-09 21:33:41 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 105 ms. Found 5 JPA repository interfaces.
2025-06-09 21:33:42 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-09 21:33:42 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-09 21:33:42 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-09 21:33:42 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-09 21:33:42 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1070 ms
2025-06-09 21:33:42 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-09 21:33:42 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@2b01c689
2025-06-09 21:33:42 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-09 21:33:42 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-09 21:33:42 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-09 21:33:42 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-09 21:33:42 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-09 21:33:42 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-09 21:33:42 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.014s)
2025-06-09 21:33:42 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 3
2025-06-09 21:33:42 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-09 21:33:42 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-09 21:33:42 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-09 21:33:42 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-09 21:33:42 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-09 21:33:42 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-09 21:33:43 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-09 21:33:43 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-09 21:33:43 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-09 21:33:44 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-09 21:33:44 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-09 21:33:44 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-09 21:33:45 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-09 21:33:45 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-09 21:33:45 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@6f61698]]
2025-06-09 21:33:45 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-09 21:33:45 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 4.037 seconds (process running for 4.54)
2025-06-09 21:34:00 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-09 21:34:00 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-09 21:34:00 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 3 ms
2025-06-09 21:34:00 [http-nio-8080-exec-2] INFO  c.e.b.controller.AuthController - User logged in successfully: username=andrey
2025-06-09 21:34:00 [http-nio-8080-exec-4] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-09 21:34:01 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 21:34:06 [http-nio-8080-exec-5] INFO  c.e.backend.service.ChatService - Created chat: id=3, title=Chat 2
2025-06-09 21:34:06 [http-nio-8080-exec-1] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 21:34:06 [http-nio-8080-exec-1] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 21:34:06 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 21:34:07 [http-nio-8080-exec-6] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=3, query=select * from my_db, llm=Local
2025-06-09 21:34:07 [http-nio-8080-exec-6] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-09 21:34:07 [http-nio-8080-exec-6] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=3, query=select * from my_db, llm=Local, isMPP=false
2025-06-09 21:34:18 [http-nio-8080-exec-6] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=4
2025-06-09 21:34:18 [http-nio-8080-exec-6] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/3: id=10
2025-06-09 21:34:18 [http-nio-8080-exec-6] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=4
2025-06-09 21:34:36 [http-nio-8080-exec-9] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 21:34:36 [http-nio-8080-exec-9] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 21:34:36 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 21:34:38 [http-nio-8080-exec-8] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-09 21:34:38 [http-nio-8080-exec-8] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-09 21:34:38 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-09 21:34:45 [MessageBroker-2] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 4 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(4)-CONNECTED(4)-DISCONNECT(3)], stompBrokerRelay[null], inboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 54], outboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 11], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 2]
2025-06-09 21:34:45 [http-nio-8080-exec-4] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=3, query=select * from my_db, llm=GigaChat
2025-06-09 21:34:45 [http-nio-8080-exec-4] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-09 21:34:45 [http-nio-8080-exec-4] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=3, query=select * from my_db, llm=GigaChat, isMPP=false
2025-06-09 21:34:45 [http-nio-8080-exec-4] INFO  c.e.b.service.GigaChatAuthService - Attempting to authenticate with GigaChat API
2025-06-09 21:34:46 [reactor-http-nio-2] INFO  c.e.b.service.GigaChatAuthService - Successfully refreshed GigaChat token, expires in 3600 seconds
2025-06-09 21:34:49 [reactor-http-nio-2] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=5
2025-06-09 21:34:49 [reactor-http-nio-2] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/3: id=12
2025-06-09 21:34:49 [reactor-http-nio-2] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=5
2025-06-11 16:03:24 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 2509 (/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/Новая папка с объектами/opt_back)
2025-06-11 16:03:24 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-11 16:03:24 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-11 16:03:24 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 84 ms. Found 5 JPA repository interfaces.
2025-06-11 16:03:25 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-11 16:03:25 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-11 16:03:25 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-11 16:03:25 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-11 16:03:25 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1114 ms
2025-06-11 16:03:25 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-11 16:03:25 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@10fb4575
2025-06-11 16:03:25 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-11 16:03:25 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-11 16:03:25 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-11 16:03:25 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-11 16:03:25 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-11 16:03:25 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-11 16:03:25 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.013s)
2025-06-11 16:03:25 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 4
2025-06-11 16:03:25 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-11 16:03:25 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-11 16:03:25 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-11 16:03:25 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-11 16:03:25 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-11 16:03:25 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-11 16:03:26 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 16:03:26 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-11 16:03:26 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-11 16:03:26 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-11 16:03:26 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-11 16:03:26 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-11 16:03:27 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-11 16:03:27 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-11 16:03:27 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5c97c816]]
2025-06-11 16:03:27 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-11 16:03:27 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 3.769 seconds (process running for 4.076)
2025-06-11 16:03:43 [http-nio-8080-exec-3] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-11 16:03:43 [http-nio-8080-exec-3] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-11 16:03:43 [http-nio-8080-exec-3] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 5 ms
2025-06-11 16:03:43 [http-nio-8080-exec-4] INFO  c.e.b.controller.AuthController - User logged in successfully: username=andrey
2025-06-11 16:03:43 [http-nio-8080-exec-6] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-11 16:03:43 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:03:50 [http-nio-8080-exec-4] INFO  c.e.backend.service.ChatService - Created chat: id=10, title=Chat 8
2025-06-11 16:03:50 [http-nio-8080-exec-1] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:03:50 [http-nio-8080-exec-1] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:03:50 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:04:13 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:04:13 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:04:13 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-11 16:04:13 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5c97c816]]
2025-06-11 16:04:13 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-11 16:04:13 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 16:04:13 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-11 16:04:13 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-11 16:08:18 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 3627 (/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/Новая папка с объектами/opt_back)
2025-06-11 16:08:18 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-11 16:08:19 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-11 16:08:19 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 78 ms. Found 5 JPA repository interfaces.
2025-06-11 16:08:19 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-11 16:08:19 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-11 16:08:19 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-11 16:08:19 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-11 16:08:19 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 907 ms
2025-06-11 16:08:19 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-11 16:08:20 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@30036a18
2025-06-11 16:08:20 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-11 16:08:20 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-11 16:08:20 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-11 16:08:20 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-11 16:08:20 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-11 16:08:20 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-11 16:08:20 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.014s)
2025-06-11 16:08:20 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 4
2025-06-11 16:08:20 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-11 16:08:20 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-11 16:08:20 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-11 16:08:20 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-11 16:08:20 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-11 16:08:20 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-11 16:08:21 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 16:08:21 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-11 16:08:21 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-11 16:08:21 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-11 16:08:21 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-11 16:08:21 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-11 16:08:22 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-11 16:08:22 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-11 16:08:22 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@6226a088]]
2025-06-11 16:08:22 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-11 16:08:22 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 3.754 seconds (process running for 4.405)
2025-06-11 16:08:23 [http-nio-8080-exec-2] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-11 16:08:23 [http-nio-8080-exec-2] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-11 16:08:23 [http-nio-8080-exec-2] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-11 16:08:23 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:08:32 [http-nio-8080-exec-7] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:08:32 [http-nio-8080-exec-7] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:08:41 [http-nio-8080-exec-8] INFO  c.e.b.controller.AuthController - User logged in successfully: username=andrey
2025-06-11 16:08:41 [http-nio-8080-exec-9] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-11 16:08:41 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:08:45 [http-nio-8080-exec-10] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:08:45 [http-nio-8080-exec-10] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:08:45 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:08:47 [http-nio-8080-exec-10] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:08:47 [http-nio-8080-exec-10] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:08:47 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:08:49 [http-nio-8080-exec-2] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=10, query=select * from chats, llm=Local
2025-06-11 16:08:49 [http-nio-8080-exec-2] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-11 16:08:49 [http-nio-8080-exec-2] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=10, query=select * from chats, llm=Local, isMPP=false
2025-06-11 16:09:12 [http-nio-8080-exec-2] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=34
2025-06-11 16:09:12 [http-nio-8080-exec-2] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/10: id=90
2025-06-11 16:09:12 [http-nio-8080-exec-2] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=34
2025-06-11 16:09:22 [MessageBroker-1] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 4 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(4)-CONNECTED(4)-DISCONNECT(2)], stompBrokerRelay[null], inboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 48], outboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 10], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 2]
2025-06-11 16:11:31 [http-nio-8080-exec-9] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:11:31 [http-nio-8080-exec-9] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:11:31 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:12:47 [http-nio-8080-exec-8] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:12:47 [http-nio-8080-exec-8] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:12:47 [http-nio-8080-exec-6] ERROR o.s.w.s.m.StompSubProtocolHandler - Error publishing SessionDisconnectEvent[sessionId=fzqcobsg, CloseStatus[code=1001, reason=WebSocket is closed before the connection is established.]]
java.lang.NullPointerException: Cannot invoke "java.security.Principal.getName()" because the return value of "org.springframework.messaging.simp.stomp.StompHeaderAccessor.getUser()" is null
	at com.example.backend.config.WebSocketMessageHandler.handleWebSocketDisconnectListener(WebSocketMessageHandler.java:93)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.context.event.ApplicationListenerMethodAdapter.doInvoke(ApplicationListenerMethodAdapter.java:365)
	at org.springframework.context.event.ApplicationListenerMethodAdapter.processEvent(ApplicationListenerMethodAdapter.java:237)
	at org.springframework.context.event.ApplicationListenerMethodAdapter.onApplicationEvent(ApplicationListenerMethodAdapter.java:168)
	at org.springframework.context.event.SimpleApplicationEventMulticaster.doInvokeListener(SimpleApplicationEventMulticaster.java:185)
	at org.springframework.context.event.SimpleApplicationEventMulticaster.invokeListener(SimpleApplicationEventMulticaster.java:178)
	at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:156)
	at org.springframework.context.support.AbstractApplicationContext.publishEvent(AbstractApplicationContext.java:451)
	at org.springframework.context.support.AbstractApplicationContext.publishEvent(AbstractApplicationContext.java:384)
	at org.springframework.web.socket.messaging.StompSubProtocolHandler.publishEvent(StompSubProtocolHandler.java:448)
	at org.springframework.web.socket.messaging.StompSubProtocolHandler.afterSessionEnded(StompSubProtocolHandler.java:683)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.clearSession(SubProtocolWebSocketHandler.java:551)
	at org.springframework.web.socket.messaging.SubProtocolWebSocketHandler.afterConnectionClosed(SubProtocolWebSocketHandler.java:419)
	at org.springframework.web.socket.handler.WebSocketHandlerDecorator.afterConnectionClosed(WebSocketHandlerDecorator.java:85)
	at org.springframework.web.socket.handler.LoggingWebSocketHandlerDecorator.afterConnectionClosed(LoggingWebSocketHandlerDecorator.java:72)
	at org.springframework.web.socket.handler.ExceptionWebSocketHandlerDecorator.afterConnectionClosed(ExceptionWebSocketHandlerDecorator.java:78)
	at org.springframework.web.socket.sockjs.transport.session.AbstractSockJsSession.delegateConnectionClosed(AbstractSockJsSession.java:395)
	at org.springframework.web.socket.sockjs.transport.handler.SockJsWebSocketHandler.afterConnectionClosed(SockJsWebSocketHandler.java:98)
	at org.springframework.web.socket.adapter.standard.StandardWebSocketHandlerAdapter.onClose(StandardWebSocketHandlerAdapter.java:144)
	at org.apache.tomcat.websocket.WsSession.fireEndpointOnClose(WsSession.java:714)
	at org.apache.tomcat.websocket.WsSession.onClose(WsSession.java:638)
	at org.apache.tomcat.websocket.WsFrameBase.processDataControl(WsFrameBase.java:347)
	at org.apache.tomcat.websocket.WsFrameBase.processData(WsFrameBase.java:279)
	at org.apache.tomcat.websocket.WsFrameBase.processInputBuffer(WsFrameBase.java:130)
	at org.apache.tomcat.websocket.server.WsFrameServer.onDataAvailable(WsFrameServer.java:85)
	at org.apache.tomcat.websocket.server.WsFrameServer.doOnDataAvailable(WsFrameServer.java:184)
	at org.apache.tomcat.websocket.server.WsFrameServer.notifyDataAvailable(WsFrameServer.java:164)
	at org.apache.tomcat.websocket.server.WsHttpUpgradeHandler.upgradeDispatch(WsHttpUpgradeHandler.java:152)
	at org.apache.coyote.http11.upgrade.UpgradeProcessorInternal.dispatch(UpgradeProcessorInternal.java:60)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:57)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-06-11 16:12:47 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:16:12 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:16:12 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:16:12 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-11 16:16:12 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@6226a088]]
2025-06-11 16:16:12 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-11 16:16:12 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 16:16:12 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-11 16:16:12 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-11 16:16:14 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 5129 (/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/Новая папка с объектами/opt_back)
2025-06-11 16:16:14 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-11 16:16:15 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-11 16:16:15 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 76 ms. Found 5 JPA repository interfaces.
2025-06-11 16:16:15 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-11 16:16:15 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-11 16:16:15 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-11 16:16:15 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-11 16:16:15 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 906 ms
2025-06-11 16:16:15 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-11 16:16:15 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@23648d2d
2025-06-11 16:16:15 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-11 16:16:15 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-11 16:16:15 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-11 16:16:15 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-11 16:16:15 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-11 16:16:15 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-11 16:16:15 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.010s)
2025-06-11 16:16:15 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 4
2025-06-11 16:16:15 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-11 16:16:15 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-11 16:16:15 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-11 16:16:15 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-11 16:16:16 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-11 16:16:16 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-11 16:16:16 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 16:16:16 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-11 16:16:16 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-11 16:16:17 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-11 16:16:17 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-11 16:16:17 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-11 16:16:17 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-11 16:16:17 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-11 16:16:17 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5ec5a449]]
2025-06-11 16:16:17 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-11 16:16:17 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 3.328 seconds (process running for 3.833)
2025-06-11 16:16:22 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-11 16:16:22 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-11 16:16:22 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-11 16:16:23 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:16:28 [http-nio-8080-exec-6] INFO  c.e.b.controller.AuthController - User logged in successfully: username=andrey
2025-06-11 16:16:28 [http-nio-8080-exec-8] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-11 16:16:28 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:16:31 [http-nio-8080-exec-2] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:16:31 [http-nio-8080-exec-2] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:16:31 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:16:47 [http-nio-8080-exec-4] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:16:47 [http-nio-8080-exec-4] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:16:48 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:16:58 [http-nio-8080-exec-7] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=10, query=select * from my_db, llm=Local
2025-06-11 16:16:58 [http-nio-8080-exec-7] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-11 16:16:58 [http-nio-8080-exec-7] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=10, query=select * from my_db, llm=Local, isMPP=false
2025-06-11 16:17:17 [MessageBroker-1] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[2 current WS(2)-HttpStream(0)-HttpPoll(0), 4 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(4)-CONNECTED(4)-DISCONNECT(2)], stompBrokerRelay[null], inboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 51], outboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 9], sockJsScheduler[pool size = 8, active threads = 1, queued tasks = 1, completed tasks = 2]
2025-06-11 16:17:18 [http-nio-8080-exec-7] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=35
2025-06-11 16:17:18 [http-nio-8080-exec-7] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/10: id=92
2025-06-11 16:17:18 [http-nio-8080-exec-7] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=35
2025-06-11 16:17:27 [http-nio-8080-exec-3] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:17:27 [http-nio-8080-exec-3] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:17:27 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:17:32 [http-nio-8080-exec-3] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:17:32 [http-nio-8080-exec-3] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:17:32 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:17:34 [http-nio-8080-exec-5] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=10, query=SELECT 
    u.username AS user_name,
    c.title AS chat_title,
    COUNT(m.id) AS message_count,
    dc.name AS db_connection_name,
    dc.db_type,
    dc.host,
    dc.port
FROM 
    users u, llm=Local
2025-06-11 16:17:34 [http-nio-8080-exec-5] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-11 16:17:34 [http-nio-8080-exec-5] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=10, query=SELECT 
    u.username AS user_name,
    c.title AS chat_title,
    COUNT(m.id) AS message_count,
    dc.name AS db_connection_name,
    dc.db_type,
    dc.host,
    dc.port
FROM 
    users u, llm=Local, isMPP=false
2025-06-11 16:17:46 [http-nio-8080-exec-5] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=36
2025-06-11 16:17:46 [http-nio-8080-exec-5] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/10: id=94
2025-06-11 16:17:46 [http-nio-8080-exec-5] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=36
2025-06-11 16:18:54 [http-nio-8080-exec-9] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=10, query=SELECT 
    u.username AS user_name,
    c.title AS chat_title,
    COUNT(m.id) AS message_count,
    dc.name AS db_connection_name,
    dc.db_type,
    dc.host,
    dc.port
FROM 
    users u, llm=Local
2025-06-11 16:18:54 [http-nio-8080-exec-9] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-11 16:18:54 [http-nio-8080-exec-9] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=10, query=SELECT 
    u.username AS user_name,
    c.title AS chat_title,
    COUNT(m.id) AS message_count,
    dc.name AS db_connection_name,
    dc.db_type,
    dc.host,
    dc.port
FROM 
    users u, llm=Local, isMPP=false
2025-06-11 16:19:05 [http-nio-8080-exec-9] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=37
2025-06-11 16:19:05 [http-nio-8080-exec-9] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/10: id=96
2025-06-11 16:19:05 [http-nio-8080-exec-9] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=37
2025-06-11 16:21:17 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:21:17 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:21:23 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:25:27 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:25:27 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:25:33 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:27:07 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:27:07 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:27:13 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:29:37 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:29:37 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:29:43 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:31:11 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:31:11 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:31:11 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:31:11 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:31:11 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-11 16:31:11 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@5ec5a449]]
2025-06-11 16:31:11 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-11 16:31:11 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 16:31:11 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-11 16:31:11 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-11 16:38:01 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 10027 (/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/Новая папка с объектами/opt_back)
2025-06-11 16:38:01 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-11 16:38:01 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-11 16:38:01 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 101 ms. Found 5 JPA repository interfaces.
2025-06-11 16:38:02 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-11 16:38:02 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-11 16:38:02 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-11 16:38:02 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-11 16:38:02 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1242 ms
2025-06-11 16:38:02 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-11 16:38:02 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@773eca84
2025-06-11 16:38:02 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-11 16:38:02 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-11 16:38:02 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-11 16:38:02 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-11 16:38:02 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-11 16:38:02 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-11 16:38:02 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.012s)
2025-06-11 16:38:02 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 4
2025-06-11 16:38:02 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-11 16:38:02 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-11 16:38:02 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-11 16:38:02 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-11 16:38:02 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-11 16:38:02 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-11 16:38:03 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 16:38:03 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-11 16:38:03 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-11 16:38:04 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-11 16:38:04 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-11 16:38:04 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-11 16:38:04 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-11 16:38:04 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-11 16:38:04 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@11a3ffe6]]
2025-06-11 16:38:04 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-11 16:38:04 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 4.07 seconds (process running for 4.551)
2025-06-11 16:38:04 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-11 16:38:04 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-11 16:38:04 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-11 16:38:05 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:38:22 [http-nio-8080-exec-6] INFO  c.e.b.controller.AuthController - User logged in successfully: username=andrey
2025-06-11 16:38:22 [http-nio-8080-exec-8] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-11 16:38:22 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:38:26 [http-nio-8080-exec-10] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=10, query=select * from my_db, llm=Local
2025-06-11 16:38:26 [http-nio-8080-exec-10] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-11 16:38:26 [http-nio-8080-exec-10] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=10, query=select * from my_db, llm=Local, isMPP=false
2025-06-11 16:38:26 [http-nio-8080-exec-10] WARN  c.e.b.service.SqlOptimizationService - Не удалось получить размер таблицы my_db: ERROR: relation "my_db" does not exist
  Позиция: 46
2025-06-11 16:38:39 [http-nio-8080-exec-10] ERROR c.e.b.service.SqlOptimizationService - SQLException during execution time measurement: ERROR: relation "my_db" does not exist
  Позиция: 31
2025-06-11 16:38:39 [http-nio-8080-exec-10] WARN  c.e.b.service.SqlOptimizationService - Failed to measure execution time or analyze query plan: ERROR: relation "my_db" does not exist
  Позиция: 31
2025-06-11 16:38:39 [http-nio-8080-exec-10] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=38
2025-06-11 16:38:39 [http-nio-8080-exec-10] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/10: id=98
2025-06-11 16:38:39 [http-nio-8080-exec-10] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=38
2025-06-11 16:39:04 [MessageBroker-3] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[2 current WS(2)-HttpStream(0)-HttpPoll(0), 2 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(2)-CONNECTED(2)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 21], outboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 4], sockJsScheduler[pool size = 6, active threads = 1, queued tasks = 1, completed tasks = 2]
2025-06-11 16:39:17 [http-nio-8080-exec-1] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=10, query=SELECT 
    u.username AS user_name,
    c.title AS chat_title,
    COUNT(m.id) AS message_count,
    dc.name AS db_connection_name,
    dc.db_type,
    dc.host,
    dc.port
FROM 
    users u, llm=Local
2025-06-11 16:39:17 [http-nio-8080-exec-1] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-11 16:39:17 [http-nio-8080-exec-1] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=10, query=SELECT 
    u.username AS user_name,
    c.title AS chat_title,
    COUNT(m.id) AS message_count,
    dc.name AS db_connection_name,
    dc.db_type,
    dc.host,
    dc.port
FROM 
    users u, llm=Local, isMPP=false
2025-06-11 16:39:34 [http-nio-8080-exec-1] ERROR c.e.b.service.SqlOptimizationService - SQLException during execution time measurement: ERROR: missing FROM-clause entry for table "c"
  Позиция: 58
2025-06-11 16:39:34 [http-nio-8080-exec-1] WARN  c.e.b.service.SqlOptimizationService - Failed to measure execution time or analyze query plan: ERROR: missing FROM-clause entry for table "c"
  Позиция: 58
2025-06-11 16:39:34 [http-nio-8080-exec-1] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=39
2025-06-11 16:39:34 [http-nio-8080-exec-1] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/10: id=100
2025-06-11 16:39:34 [http-nio-8080-exec-1] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=39
2025-06-11 16:42:39 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:42:39 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:42:44 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:42:49 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:42:49 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:42:49 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:42:49 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:42:49 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-11 16:42:49 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@11a3ffe6]]
2025-06-11 16:42:49 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-11 16:42:49 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 16:42:49 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-11 16:42:49 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-11 16:42:53 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 11105 (/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/Новая папка с объектами/opt_back)
2025-06-11 16:42:53 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-11 16:42:54 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-11 16:42:54 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 87 ms. Found 5 JPA repository interfaces.
2025-06-11 16:42:55 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-11 16:42:55 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-11 16:42:55 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-11 16:42:55 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-11 16:42:55 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1180 ms
2025-06-11 16:42:55 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-11 16:42:55 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@2bcda694
2025-06-11 16:42:55 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-11 16:42:55 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-11 16:42:55 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-11 16:42:55 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-11 16:42:55 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-11 16:42:55 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-11 16:42:55 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.014s)
2025-06-11 16:42:55 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 4
2025-06-11 16:42:55 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-11 16:42:55 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-11 16:42:55 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-11 16:42:55 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-11 16:42:55 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-11 16:42:55 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-11 16:42:56 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 16:42:56 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-11 16:42:56 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-11 16:42:56 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-11 16:42:56 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-11 16:42:57 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-11 16:42:57 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-11 16:42:57 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-11 16:42:57 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@1d546842]]
2025-06-11 16:42:57 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-11 16:42:57 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 4.083 seconds (process running for 4.406)
2025-06-11 16:43:11 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-11 16:43:11 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-11 16:43:11 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 4 ms
2025-06-11 16:43:12 [http-nio-8080-exec-1] INFO  c.e.b.controller.AuthController - User logged in successfully: username=andrey
2025-06-11 16:43:12 [http-nio-8080-exec-2] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-11 16:43:12 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:43:15 [http-nio-8080-exec-10] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=10, query=select * from my_db, llm=Local
2025-06-11 16:43:15 [http-nio-8080-exec-10] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-11 16:43:15 [http-nio-8080-exec-10] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=10, query=select * from my_db, llm=Local, isMPP=false
2025-06-11 16:43:15 [http-nio-8080-exec-10] WARN  c.e.b.service.SqlOptimizationService - Не удалось получить размер таблицы my_db: ERROR: relation "my_db" does not exist
  Позиция: 46
2025-06-11 16:43:29 [http-nio-8080-exec-10] ERROR c.e.b.service.SqlOptimizationService - SQLException during execution time measurement: ERROR: relation "my_db" does not exist
  Позиция: 31
2025-06-11 16:43:29 [http-nio-8080-exec-10] WARN  c.e.b.service.SqlOptimizationService - Failed to measure execution time or analyze query plan: ERROR: relation "my_db" does not exist
  Позиция: 31
2025-06-11 16:43:29 [http-nio-8080-exec-10] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=40
2025-06-11 16:43:29 [http-nio-8080-exec-10] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/10: id=102
2025-06-11 16:43:29 [http-nio-8080-exec-10] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=40
2025-06-11 16:43:57 [MessageBroker-2] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 1 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(1)-CONNECTED(1)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 9], outboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 2], sockJsScheduler[pool size = 5, active threads = 1, queued tasks = 1, completed tasks = 2]
2025-06-11 16:47:29 [http-nio-8080-exec-4] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:47:29 [http-nio-8080-exec-4] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:47:29 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:47:46 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:47:46 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:47:46 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-11 16:47:46 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@1d546842]]
2025-06-11 16:47:46 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-11 16:47:46 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 16:47:47 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-11 16:47:47 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-11 16:47:50 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 12307 (/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/Новая папка с объектами/opt_back)
2025-06-11 16:47:50 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-11 16:47:51 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-11 16:47:51 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 144 ms. Found 5 JPA repository interfaces.
2025-06-11 16:47:52 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-11 16:47:52 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-11 16:47:52 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-11 16:47:52 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-11 16:47:52 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1151 ms
2025-06-11 16:47:52 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-11 16:47:52 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@773eca84
2025-06-11 16:47:52 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-11 16:47:52 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-11 16:47:52 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-11 16:47:52 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-11 16:47:52 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-11 16:47:52 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-11 16:47:52 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.014s)
2025-06-11 16:47:52 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 4
2025-06-11 16:47:52 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-11 16:47:52 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-11 16:47:52 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-11 16:47:52 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-11 16:47:52 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-11 16:47:52 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-11 16:47:53 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 16:47:53 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-11 16:47:53 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-11 16:47:53 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-11 16:47:53 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-11 16:47:54 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-11 16:47:54 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-11 16:47:54 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-11 16:47:54 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@66cdde2b]]
2025-06-11 16:47:54 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-11 16:47:54 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 3.933 seconds (process running for 4.623)
2025-06-11 16:48:54 [MessageBroker-1] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 1, active threads = 1, queued tasks = 0, completed tasks = 0]
2025-06-11 16:49:02 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-11 16:49:02 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-11 16:49:02 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-06-11 16:49:02 [http-nio-8080-exec-2] INFO  c.e.b.controller.AuthController - User logged in successfully: username=andrey
2025-06-11 16:49:02 [http-nio-8080-exec-4] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-11 16:49:02 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:49:09 [http-nio-8080-exec-6] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=10, query=select * from my_db, llm=Local
2025-06-11 16:49:09 [http-nio-8080-exec-6] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-11 16:49:09 [http-nio-8080-exec-6] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=10, query=select * from my_db, llm=Local, isMPP=false
2025-06-11 16:49:10 [http-nio-8080-exec-6] WARN  c.e.b.service.SqlOptimizationService - Не удалось получить размер таблицы my_db: ERROR: relation "my_db" does not exist
  Позиция: 46
2025-06-11 16:49:25 [http-nio-8080-exec-6] ERROR c.e.b.service.SqlOptimizationService - SQLException during execution time measurement: ERROR: relation "my_db" does not exist
  Позиция: 31
2025-06-11 16:49:25 [http-nio-8080-exec-6] WARN  c.e.b.service.SqlOptimizationService - Failed to measure execution time or analyze query plan: ERROR: relation "my_db" does not exist
  Позиция: 31
2025-06-11 16:49:25 [http-nio-8080-exec-6] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=41
2025-06-11 16:49:25 [http-nio-8080-exec-6] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/10: id=104
2025-06-11 16:49:25 [http-nio-8080-exec-6] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=41
2025-06-11 16:50:40 [http-nio-8080-exec-6] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:50:40 [http-nio-8080-exec-6] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:50:40 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:51:15 [http-nio-8080-exec-3] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:51:15 [http-nio-8080-exec-3] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:51:15 [http-nio-8080-exec-4] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-11 16:51:15 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:51:49 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:51:49 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:51:49 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-11 16:51:49 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@66cdde2b]]
2025-06-11 16:51:49 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-11 16:51:49 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 16:51:49 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-11 16:51:49 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-11 16:51:52 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 13204 (/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/Новая папка с объектами/opt_back)
2025-06-11 16:51:52 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-11 16:51:53 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-11 16:51:53 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 86 ms. Found 5 JPA repository interfaces.
2025-06-11 16:51:53 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-11 16:51:53 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-11 16:51:53 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-11 16:51:53 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-11 16:51:53 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1069 ms
2025-06-11 16:51:53 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-11 16:51:54 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@119d4443
2025-06-11 16:51:54 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-11 16:51:54 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-11 16:51:54 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-11 16:51:54 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-11 16:51:54 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-11 16:51:54 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-11 16:51:54 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.014s)
2025-06-11 16:51:54 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 4
2025-06-11 16:51:54 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-11 16:51:54 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-11 16:51:54 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-11 16:51:54 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-11 16:51:54 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-11 16:51:54 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-11 16:51:55 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 16:51:55 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-11 16:51:55 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-11 16:51:55 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-11 16:51:55 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-11 16:51:55 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-11 16:51:56 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-11 16:51:56 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-11 16:51:56 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@68321229]]
2025-06-11 16:51:56 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-11 16:51:56 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 3.904 seconds (process running for 4.406)
2025-06-11 16:52:05 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-11 16:52:05 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-11 16:52:05 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-06-11 16:52:07 [http-nio-8080-exec-2] INFO  c.e.b.controller.AuthController - User logged in successfully: username=andrey
2025-06-11 16:52:07 [http-nio-8080-exec-3] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-11 16:52:07 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:52:12 [http-nio-8080-exec-1] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=10, query=select * from my_db, llm=Local
2025-06-11 16:52:12 [http-nio-8080-exec-1] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-11 16:52:12 [http-nio-8080-exec-1] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=10, query=select * from my_db, llm=Local, isMPP=false
2025-06-11 16:52:13 [http-nio-8080-exec-1] WARN  c.e.b.service.SqlOptimizationService - Не удалось получить размер таблицы my_db: ERROR: relation "my_db" does not exist
  Позиция: 46
2025-06-11 16:52:19 [http-nio-8080-exec-1] ERROR c.e.b.service.SqlOptimizationService - SQLException during execution time measurement: ERROR: relation "my_db" does not exist
  Позиция: 31
2025-06-11 16:52:19 [http-nio-8080-exec-1] WARN  c.e.b.service.SqlOptimizationService - Failed to measure execution time or analyze query plan: ERROR: relation "my_db" does not exist
  Позиция: 31
2025-06-11 16:52:19 [http-nio-8080-exec-1] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=42
2025-06-11 16:52:19 [http-nio-8080-exec-1] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/10: id=106
2025-06-11 16:52:19 [http-nio-8080-exec-1] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=42
2025-06-11 16:52:54 [http-nio-8080-exec-5] INFO  c.e.backend.service.ChatService - Created chat: id=11, title=Chat 9
2025-06-11 16:52:54 [http-nio-8080-exec-1] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:52:54 [http-nio-8080-exec-1] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:52:54 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:52:56 [MessageBroker-3] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 2 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(2)-CONNECTED(2)-DISCONNECT(1)], stompBrokerRelay[null], inboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 24], outboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 6], sockJsScheduler[pool size = 6, active threads = 1, queued tasks = 1, completed tasks = 2]
2025-06-11 16:53:26 [http-nio-8080-exec-7] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=11, query=SELECT 
    u.username AS user_name,
    c.title AS chat_title,
    COUNT(m.id) AS message_count,
    dc.name AS db_connection_name,
    dc.db_type,
    dc.host,
    dc.port
FROM 
    users u, llm=Local
2025-06-11 16:53:26 [http-nio-8080-exec-7] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-11 16:53:26 [http-nio-8080-exec-7] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=11, query=SELECT 
    u.username AS user_name,
    c.title AS chat_title,
    COUNT(m.id) AS message_count,
    dc.name AS db_connection_name,
    dc.db_type,
    dc.host,
    dc.port
FROM 
    users u, llm=Local, isMPP=false
2025-06-11 16:54:26 [http-nio-8080-exec-7] ERROR c.example.backend.service.LLMService - Error calling local LLM: I/O error on POST request for "http://localhost:1234/v1/chat/completions": Read timed out
org.springframework.web.client.ResourceAccessException: I/O error on POST request for "http://localhost:1234/v1/chat/completions": Read timed out
	at org.springframework.web.client.RestTemplate.createResourceAccessException(RestTemplate.java:915)
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:895)
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:790)
	at org.springframework.web.client.RestTemplate.postForObject(RestTemplate.java:507)
	at com.example.backend.service.LLMService.lambda$optimizeWithLocalLLM$0(LLMService.java:60)
	at reactor.core.publisher.MonoCallable$MonoCallableSubscription.request(MonoCallable.java:137)
	at reactor.core.publisher.Operators$MultiSubscriptionSubscriber.set(Operators.java:2367)
	at reactor.core.publisher.Operators$MultiSubscriptionSubscriber.onSubscribe(Operators.java:2241)
	at reactor.core.publisher.MonoCallable.subscribe(MonoCallable.java:48)
	at reactor.core.publisher.FluxRetryWhen.subscribe(FluxRetryWhen.java:81)
	at reactor.core.publisher.MonoRetryWhen.subscribeOrReturn(MonoRetryWhen.java:46)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4547)
	at reactor.core.publisher.FluxFlatMap.trySubscribeScalarMap(FluxFlatMap.java:202)
	at reactor.core.publisher.MonoFlatMap.subscribeOrReturn(MonoFlatMap.java:53)
	at reactor.core.publisher.Mono.subscribe(Mono.java:4547)
	at org.springframework.web.servlet.mvc.method.annotation.ReactiveTypeHandler$DeferredResultSubscriber.connect(ReactiveTypeHandler.java:465)
	at org.springframework.web.servlet.mvc.method.annotation.ReactiveTypeHandler.handleValue(ReactiveTypeHandler.java:163)
	at org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitterReturnValueHandler.handleReturnValue(ResponseBodyEmitterReturnValueHandler.java:154)
	at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:78)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:136)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:920)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:830)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:547)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:614)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at com.example.backend.security.JwtTokenFilter.doFilterInternal(JwtTokenFilter.java:32)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:230)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.net.SocketTimeoutException: Read timed out
	at java.base/sun.nio.ch.NioSocketImpl.timedRead(NioSocketImpl.java:278)
	at java.base/sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:304)
	at java.base/sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:346)
	at java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:796)
	at java.base/java.net.Socket$SocketInputStream.read(Socket.java:1099)
	at java.base/java.io.BufferedInputStream.fill(BufferedInputStream.java:291)
	at java.base/java.io.BufferedInputStream.read1(BufferedInputStream.java:347)
	at java.base/java.io.BufferedInputStream.implRead(BufferedInputStream.java:420)
	at java.base/java.io.BufferedInputStream.read(BufferedInputStream.java:399)
	at java.base/sun.net.www.http.HttpClient.parseHTTPHeader(HttpClient.java:827)
	at java.base/sun.net.www.http.HttpClient.parseHTTP(HttpClient.java:759)
	at java.base/sun.net.www.protocol.http.HttpURLConnection.getInputStream0(HttpURLConnection.java:1705)
	at java.base/sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1614)
	at java.base/java.net.HttpURLConnection.getResponseCode(HttpURLConnection.java:531)
	at org.springframework.http.client.SimpleClientHttpResponse.getStatusCode(SimpleClientHttpResponse.java:55)
	at org.springframework.web.client.DefaultResponseErrorHandler.hasError(DefaultResponseErrorHandler.java:83)
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:931)
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:891)
	... 114 common frames omitted
2025-06-11 16:54:38 [parallel-1] INFO  c.e.b.service.SqlOptimizationService - SQL query saved: id=43
2025-06-11 16:54:38 [parallel-1] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/11: id=108
2025-06-11 16:54:38 [parallel-1] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=43
2025-06-11 16:58:44 [http-nio-8080-exec-2] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:58:44 [http-nio-8080-exec-2] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:58:44 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 16:58:52 [http-nio-8080-exec-2] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 16:58:52 [http-nio-8080-exec-2] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 16:58:52 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 17:00:45 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 17:00:45 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 17:00:45 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-11 17:00:45 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@68321229]]
2025-06-11 17:00:45 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-11 17:00:46 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 17:00:46 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-11 17:00:46 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-11 17:16:32 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 18917 (/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/Новая папка с объектами/opt_back)
2025-06-11 17:16:32 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-11 17:16:32 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-11 17:16:32 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 81 ms. Found 5 JPA repository interfaces.
2025-06-11 17:16:33 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-11 17:16:33 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-11 17:16:33 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-11 17:16:33 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-11 17:16:33 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 898 ms
2025-06-11 17:16:33 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-11 17:16:33 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@7cc2c551
2025-06-11 17:16:33 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-11 17:16:33 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-11 17:16:33 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-11 17:16:33 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-11 17:16:33 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-11 17:16:33 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-11 17:16:33 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.047s)
2025-06-11 17:16:33 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 4
2025-06-11 17:16:33 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-11 17:16:33 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-11 17:16:33 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-11 17:16:33 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-11 17:16:33 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-11 17:16:34 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-11 17:16:34 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 17:16:34 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-11 17:16:34 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-11 17:16:35 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-11 17:16:35 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-11 17:16:35 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-11 17:16:35 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-11 17:16:35 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-11 17:16:35 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@7db373b2]]
2025-06-11 17:16:35 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-11 17:16:35 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 3.606 seconds (process running for 4.249)
2025-06-11 17:16:35 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-11 17:16:35 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@7db373b2]]
2025-06-11 17:16:35 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-11 17:16:35 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 17:16:35 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-11 17:16:35 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-11 17:19:48 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 19951 (/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/Новая папка с объектами/opt_back)
2025-06-11 17:19:48 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-11 17:19:49 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-11 17:19:50 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 513 ms. Found 5 JPA repository interfaces.
2025-06-11 17:19:51 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-11 17:19:51 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-11 17:19:51 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-11 17:19:51 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-11 17:19:51 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 2345 ms
2025-06-11 17:19:51 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-11 17:19:51 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@7d47dfed
2025-06-11 17:19:51 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-11 17:19:51 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-11 17:19:51 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-11 17:19:51 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-11 17:19:51 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-11 17:19:51 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-11 17:19:51 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.012s)
2025-06-11 17:19:51 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 4
2025-06-11 17:19:51 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-11 17:19:51 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-11 17:19:51 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-11 17:19:51 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-11 17:19:51 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-11 17:19:51 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-11 17:19:52 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 17:19:52 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-11 17:19:52 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-11 17:19:53 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-11 17:19:53 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-11 17:19:53 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-11 17:19:53 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'sqlOptimizationController' defined in file [/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main/com/example/backend/controller/SqlOptimizationController.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'sqlOptimizationService' defined in file [/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main/com/example/backend/service/SqlOptimizationService.class]: Unsatisfied dependency expressed through constructor parameter 4: Error creating bean with name 'LLMService' defined in file [/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main/com/example/backend/service/LLMService.class]: Unexpected exception during bean creation
2025-06-11 17:19:53 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 17:19:53 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-11 17:19:53 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-11 17:19:53 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-11 17:19:53 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-11 17:19:53 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'sqlOptimizationController' defined in file [/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main/com/example/backend/controller/SqlOptimizationController.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'sqlOptimizationService' defined in file [/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main/com/example/backend/service/SqlOptimizationService.class]: Unsatisfied dependency expressed through constructor parameter 4: Error creating bean with name 'LLMService' defined in file [/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main/com/example/backend/service/LLMService.class]: Unexpected exception during bean creation
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:798)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1355)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1192)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:975)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:959)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.example.backend.BackendApplication.main(BackendApplication.java:12)
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'sqlOptimizationService' defined in file [/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main/com/example/backend/service/SqlOptimizationService.class]: Unsatisfied dependency expressed through constructor parameter 4: Error creating bean with name 'LLMService' defined in file [/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main/com/example/backend/service/LLMService.class]: Unexpected exception during bean creation
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:798)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1355)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1192)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:907)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:785)
	... 19 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'LLMService' defined in file [/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main/com/example/backend/service/LLMService.class]: Unexpected exception during bean creation
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:535)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:907)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:785)
	... 33 common frames omitted
Caused by: java.lang.IllegalArgumentException: Could not resolve placeholder 'llm.local.url' in value "${llm.local.url}"
	at org.springframework.util.PropertyPlaceholderHelper.parseStringValue(PropertyPlaceholderHelper.java:180)
	at org.springframework.util.PropertyPlaceholderHelper.replacePlaceholders(PropertyPlaceholderHelper.java:126)
	at org.springframework.core.env.AbstractPropertyResolver.doResolvePlaceholders(AbstractPropertyResolver.java:239)
	at org.springframework.core.env.AbstractPropertyResolver.resolveRequiredPlaceholders(AbstractPropertyResolver.java:210)
	at org.springframework.context.support.PropertySourcesPlaceholderConfigurer.lambda$processProperties$0(PropertySourcesPlaceholderConfigurer.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.resolveEmbeddedValue(AbstractBeanFactory.java:921)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1374)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:907)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:785)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1355)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1192)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	... 42 common frames omitted
2025-06-11 17:20:58 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 20394 (/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/Новая папка с объектами/opt_back)
2025-06-11 17:20:58 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-11 17:20:58 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-11 17:20:58 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 81 ms. Found 5 JPA repository interfaces.
2025-06-11 17:20:59 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-11 17:20:59 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-11 17:20:59 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-11 17:20:59 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-11 17:20:59 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1011 ms
2025-06-11 17:20:59 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-11 17:20:59 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@781dac73
2025-06-11 17:20:59 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-11 17:20:59 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-11 17:20:59 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-11 17:20:59 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-11 17:20:59 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-11 17:20:59 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-11 17:20:59 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.012s)
2025-06-11 17:20:59 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 4
2025-06-11 17:20:59 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-11 17:20:59 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-11 17:20:59 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-11 17:20:59 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-11 17:20:59 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-11 17:20:59 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-11 17:21:00 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 17:21:00 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-11 17:21:00 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-11 17:21:01 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-11 17:21:01 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-11 17:21:01 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-11 17:21:01 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-11 17:21:01 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-11 17:21:01 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@477b8d7d]]
2025-06-11 17:21:01 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-11 17:21:01 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 3.725 seconds (process running for 4.15)
2025-06-11 17:21:05 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-11 17:21:05 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-11 17:21:05 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-11 17:21:05 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 17:21:09 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 17:21:09 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 17:21:21 [http-nio-8080-exec-7] INFO  c.e.b.controller.AuthController - User logged in successfully: username=andrey
2025-06-11 17:21:21 [http-nio-8080-exec-9] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-11 17:21:21 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 17:21:30 [http-nio-8080-exec-1] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=11, query=SELECT 
    u.username AS user_name,
    c.title AS chat_title,
    COUNT(m.id) AS message_count,
    dc.name AS db_connection_name,
    dc.db_type,
    dc.host,
    dc.port
FROM 
    users u, llm=Local
2025-06-11 17:21:30 [http-nio-8080-exec-1] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-11 17:21:30 [http-nio-8080-exec-1] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=11, query=SELECT 
    u.username AS user_name,
    c.title AS chat_title,
    COUNT(m.id) AS message_count,
    dc.name AS db_connection_name,
    dc.db_type,
    dc.host,
    dc.port
FROM 
    users u, llm=Local, isMPP=false
2025-06-11 17:21:30 [http-nio-8080-exec-1] INFO  c.example.backend.service.LLMService - Calling local LLM service with prompt length: 1037
2025-06-11 17:21:30 [boundedElastic-1] WARN  c.example.backend.service.LLMService - Retry 1 of 3 after timeout
2025-06-11 17:21:31 [boundedElastic-1] WARN  c.example.backend.service.LLMService - Retry 2 of 3 after timeout
2025-06-11 17:21:32 [boundedElastic-1] ERROR c.example.backend.service.LLMService - Failed to call LLM service after 3 retries: I/O error on POST request for "http://localhost:8000/v1/chat/completions": Connection refused
2025-06-11 17:21:32 [boundedElastic-1] ERROR c.e.b.service.SqlOptimizationService - Error during LLM optimization: LLM service is not responding. Please try again later.
2025-06-11 17:21:32 [boundedElastic-1] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/11: id=109
2025-06-11 17:21:32 [boundedElastic-1] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=44
2025-06-11 17:22:01 [MessageBroker-2] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 2 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(2)-CONNECTED(2)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 18], outboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 4], sockJsScheduler[pool size = 6, active threads = 1, queued tasks = 1, completed tasks = 2]
2025-06-11 17:25:39 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 17:25:39 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 17:25:39 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-11 17:25:39 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@477b8d7d]]
2025-06-11 17:25:39 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-11 17:25:39 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 17:25:39 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-11 17:25:39 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-11 17:25:41 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 21557 (/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/Новая папка с объектами/opt_back)
2025-06-11 17:25:41 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-11 17:25:42 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-11 17:25:42 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 82 ms. Found 5 JPA repository interfaces.
2025-06-11 17:25:42 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-11 17:25:42 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-11 17:25:42 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-11 17:25:42 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-11 17:25:42 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 983 ms
2025-06-11 17:25:42 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-11 17:25:43 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@50f4b83d
2025-06-11 17:25:43 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-11 17:25:43 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-11 17:25:43 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-11 17:25:43 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-11 17:25:43 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-11 17:25:43 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-11 17:25:43 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.012s)
2025-06-11 17:25:43 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 4
2025-06-11 17:25:43 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-11 17:25:43 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-11 17:25:43 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-11 17:25:43 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-11 17:25:43 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-11 17:25:43 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-11 17:25:43 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 17:25:44 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-11 17:25:44 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-11 17:25:44 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-11 17:25:44 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-11 17:25:44 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-11 17:25:45 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-11 17:25:45 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-11 17:25:45 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@6cb6a38c]]
2025-06-11 17:25:45 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-11 17:25:45 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 3.933 seconds (process running for 4.399)
2025-06-11 17:25:49 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-11 17:25:49 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-11 17:25:49 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-06-11 17:25:49 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 17:25:52 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 17:25:52 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 17:25:58 [http-nio-8080-exec-6] ERROR c.e.b.controller.AuthController - Login failed: User not found
2025-06-11 17:26:02 [http-nio-8080-exec-7] INFO  c.e.b.controller.AuthController - User logged in successfully: username=andrey
2025-06-11 17:26:02 [http-nio-8080-exec-8] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-11 17:26:03 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 17:26:10 [http-nio-8080-exec-6] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=11, query=SELECT 
    u.username AS user_name,
    c.title AS chat_title,
    COUNT(m.id) AS message_count,
    dc.name AS db_connection_name,
    dc.db_type,
    dc.host,
    dc.port
FROM 
    users u, llm=Local
2025-06-11 17:26:10 [http-nio-8080-exec-6] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-11 17:26:10 [http-nio-8080-exec-6] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=11, query=SELECT 
    u.username AS user_name,
    c.title AS chat_title,
    COUNT(m.id) AS message_count,
    dc.name AS db_connection_name,
    dc.db_type,
    dc.host,
    dc.port
FROM 
    users u, llm=Local, isMPP=false
2025-06-11 17:26:10 [http-nio-8080-exec-6] INFO  c.example.backend.service.LLMService - Calling local LLM service with prompt length: 1194
2025-06-11 17:26:10 [boundedElastic-1] WARN  c.example.backend.service.LLMService - Retry 1 of 3 after timeout
2025-06-11 17:26:11 [boundedElastic-1] WARN  c.example.backend.service.LLMService - Retry 2 of 3 after timeout
2025-06-11 17:26:12 [boundedElastic-1] ERROR c.example.backend.service.LLMService - Failed to call LLM service after 3 retries: I/O error on POST request for "http://localhost:8000/v1/chat/completions": Connection refused
2025-06-11 17:26:12 [boundedElastic-1] ERROR c.e.b.service.SqlOptimizationService - Error during LLM optimization: LLM service is not responding. Please try again later.
2025-06-11 17:26:12 [boundedElastic-1] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/11: id=110
2025-06-11 17:26:12 [boundedElastic-1] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=45
2025-06-11 17:26:45 [MessageBroker-3] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 2 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(2)-CONNECTED(2)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 18], outboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 4], sockJsScheduler[pool size = 6, active threads = 1, queued tasks = 1, completed tasks = 2]
2025-06-11 17:30:45 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 17:30:45 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 17:30:50 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 17:32:13 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 17:32:13 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 17:32:13 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-11 17:32:13 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@6cb6a38c]]
2025-06-11 17:32:13 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-11 17:32:13 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 17:32:13 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-11 17:32:13 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-11 17:36:01 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 23942 (/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/Новая папка с объектами/opt_back)
2025-06-11 17:36:02 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-11 17:36:02 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-11 17:36:02 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 160 ms. Found 5 JPA repository interfaces.
2025-06-11 17:36:03 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-11 17:36:03 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-11 17:36:03 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-11 17:36:03 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-11 17:36:03 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1469 ms
2025-06-11 17:36:03 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-11 17:36:03 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@5d66ae3a
2025-06-11 17:36:03 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-11 17:36:03 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-11 17:36:03 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-11 17:36:03 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-11 17:36:03 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-11 17:36:03 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-11 17:36:03 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.011s)
2025-06-11 17:36:03 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 4
2025-06-11 17:36:03 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-11 17:36:03 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-11 17:36:03 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-11 17:36:03 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-11 17:36:03 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-11 17:36:04 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-11 17:36:04 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 17:36:04 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-11 17:36:04 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-11 17:36:05 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-11 17:36:05 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-11 17:36:05 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-11 17:36:05 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-11 17:36:05 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-11 17:36:05 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@2c7178ed]]
2025-06-11 17:36:05 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-11 17:36:05 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 4.002 seconds (process running for 4.322)
2025-06-11 17:36:08 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-11 17:36:08 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-11 17:36:08 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-11 17:36:08 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 17:36:15 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 17:36:15 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 17:36:23 [http-nio-8080-exec-7] INFO  c.e.b.controller.AuthController - User logged in successfully: username=andrey
2025-06-11 17:36:23 [http-nio-8080-exec-9] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-11 17:36:23 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 17:36:29 [http-nio-8080-exec-1] INFO  c.e.backend.service.ChatService - Created chat: id=12, title=Chat 10
2025-06-11 17:36:29 [http-nio-8080-exec-3] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 17:36:29 [http-nio-8080-exec-3] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 17:36:29 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 17:36:30 [http-nio-8080-exec-5] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=12, query=SELECT 
    u.username AS user_name,
    c.title AS chat_title,
    COUNT(m.id) AS message_count,
    dc.name AS db_connection_name,
    dc.db_type,
    dc.host,
    dc.port
FROM 
    users u, llm=Local
2025-06-11 17:36:30 [http-nio-8080-exec-5] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-11 17:36:30 [http-nio-8080-exec-5] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=12, query=SELECT 
    u.username AS user_name,
    c.title AS chat_title,
    COUNT(m.id) AS message_count,
    dc.name AS db_connection_name,
    dc.db_type,
    dc.host,
    dc.port
FROM 
    users u, llm=Local, isMPP=false
2025-06-11 17:36:30 [http-nio-8080-exec-5] INFO  c.example.backend.service.LLMService - Calling local LLM service with prompt length: 1128
2025-06-11 17:36:30 [boundedElastic-1] WARN  c.example.backend.service.LLMService - Retry 1 of 3 after timeout
2025-06-11 17:36:31 [boundedElastic-1] WARN  c.example.backend.service.LLMService - Retry 2 of 3 after timeout
2025-06-11 17:36:32 [boundedElastic-1] ERROR c.example.backend.service.LLMService - Failed to call LLM service after 3 retries: I/O error on POST request for "http://localhost:8000/v1/chat/completions": Connection refused
2025-06-11 17:36:32 [boundedElastic-1] ERROR c.e.b.service.SqlOptimizationService - Error during LLM optimization: LLM service is not responding. Please try again later.
2025-06-11 17:36:32 [boundedElastic-1] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/12: id=111
2025-06-11 17:36:32 [boundedElastic-1] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=46
2025-06-11 17:37:05 [MessageBroker-1] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 3 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(3)-CONNECTED(3)-DISCONNECT(1)], stompBrokerRelay[null], inboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 33], outboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 7], sockJsScheduler[pool size = 7, active threads = 1, queued tasks = 1, completed tasks = 2]
2025-06-11 17:39:24 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 17:39:24 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 17:39:24 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-11 17:39:24 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@2c7178ed]]
2025-06-11 17:39:24 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-11 17:39:24 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 17:39:24 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-11 17:39:24 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-11 17:39:26 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 24762 (/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/Новая папка с объектами/opt_back)
2025-06-11 17:39:26 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-11 17:39:27 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-11 17:39:27 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 82 ms. Found 5 JPA repository interfaces.
2025-06-11 17:39:27 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-11 17:39:27 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-11 17:39:27 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-11 17:39:27 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-11 17:39:27 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 917 ms
2025-06-11 17:39:27 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-11 17:39:27 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@69feb4d9
2025-06-11 17:39:27 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-11 17:39:27 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-11 17:39:27 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-11 17:39:27 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-11 17:39:27 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-11 17:39:28 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-11 17:39:28 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.011s)
2025-06-11 17:39:28 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 4
2025-06-11 17:39:28 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-11 17:39:28 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-11 17:39:28 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-11 17:39:28 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-11 17:39:28 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-11 17:39:28 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-11 17:39:28 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 17:39:29 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-11 17:39:29 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-11 17:39:29 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-11 17:39:29 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-11 17:39:29 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-11 17:39:30 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-11 17:39:30 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-11 17:39:30 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@4f60ac31]]
2025-06-11 17:39:30 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-11 17:39:30 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 3.414 seconds (process running for 3.763)
2025-06-11 17:39:35 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-11 17:39:35 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-11 17:39:35 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-11 17:39:35 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 17:39:40 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 17:39:40 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 17:39:49 [http-nio-8080-exec-6] INFO  c.e.b.controller.AuthController - User logged in successfully: username=andrey
2025-06-11 17:39:49 [http-nio-8080-exec-7] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-11 17:39:49 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 17:39:57 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 17:39:57 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 17:39:57 [http-nio-8080-exec-6] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-11 17:39:57 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 17:39:59 [http-nio-8080-exec-4] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=12, query=SELECT 
    u.username AS user_name,
    c.title AS chat_title,
    COUNT(m.id) AS message_count,
    dc.name AS db_connection_name,
    dc.db_type,
    dc.host,
    dc.port
FROM 
    users u, llm=Local
2025-06-11 17:39:59 [http-nio-8080-exec-4] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-11 17:39:59 [http-nio-8080-exec-4] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=12, query=SELECT 
    u.username AS user_name,
    c.title AS chat_title,
    COUNT(m.id) AS message_count,
    dc.name AS db_connection_name,
    dc.db_type,
    dc.host,
    dc.port
FROM 
    users u, llm=Local, isMPP=false
2025-06-11 17:39:59 [http-nio-8080-exec-4] INFO  c.example.backend.service.LLMService - Calling local LLM service with prompt length: 1128
2025-06-11 17:39:59 [boundedElastic-1] WARN  c.example.backend.service.LLMService - Retry 1 of 3 after timeout
2025-06-11 17:40:00 [boundedElastic-1] WARN  c.example.backend.service.LLMService - Retry 2 of 3 after timeout
2025-06-11 17:40:01 [boundedElastic-1] ERROR c.example.backend.service.LLMService - Failed to call LLM service after 3 retries: I/O error on POST request for "http://localhost:8000/v1/chat/completions": Connection refused
2025-06-11 17:40:01 [boundedElastic-1] ERROR c.e.b.service.SqlOptimizationService - Error during LLM optimization: LLM service is not responding. Please try again later.
2025-06-11 17:40:01 [boundedElastic-1] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/12: id=112
2025-06-11 17:40:01 [boundedElastic-1] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=47
2025-06-11 17:40:30 [MessageBroker-1] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 3 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(3)-CONNECTED(3)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 27], outboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 6], sockJsScheduler[pool size = 7, active threads = 1, queued tasks = 1, completed tasks = 2]
2025-06-11 17:40:43 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 17:40:43 [SpringApplicationShutdownHook] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 17:40:43 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopping...
2025-06-11 17:40:43 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@4f60ac31]]
2025-06-11 17:40:43 [SpringApplicationShutdownHook] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Stopped.
2025-06-11 17:40:43 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 17:40:43 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-11 17:40:43 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-11 17:40:45 [main] INFO  c.example.backend.BackendApplication - Starting BackendApplication using Java 21.0.7 with PID 25036 (/Users/andreyshelyagin/Новая папка с объектами/opt_back/build/classes/java/main started by andreyshelyagin in /Users/andreyshelyagin/Новая папка с объектами/opt_back)
2025-06-11 17:40:45 [main] INFO  c.example.backend.BackendApplication - No active profile set, falling back to 1 default profile: "default"
2025-06-11 17:40:46 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-11 17:40:46 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 94 ms. Found 5 JPA repository interfaces.
2025-06-11 17:40:46 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-11 17:40:46 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-11 17:40:46 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-06-11 17:40:46 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-06-11 17:40:46 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1042 ms
2025-06-11 17:40:46 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-11 17:40:46 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@37c1cfa
2025-06-11 17:40:46 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-11 17:40:46 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-11 17:40:46 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-11 17:40:46 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-11 17:40:46 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:postgresql://localhost:5432/sql_optimizer (PostgreSQL 17.4)
2025-06-11 17:40:46 [main] WARN  o.f.c.i.database.base.Database - Flyway upgrade recommended: PostgreSQL 17.4 is newer than this version of Flyway and support has not been tested. The latest supported version of PostgreSQL is 15.
2025-06-11 17:40:46 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.012s)
2025-06-11 17:40:46 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema "public": 4
2025-06-11 17:40:46 [main] INFO  o.f.core.internal.command.DbMigrate - Schema "public" is up to date. No migration necessary.
2025-06-11 17:40:46 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-11 17:40:47 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-11 17:40:47 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-11 17:40:47 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-11 17:40:47 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-11 17:40:47 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-11 17:40:48 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - JSqlParser is in classpath; If applicable, JSqlParser will be used
2025-06-11 17:40:48 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-06-11 17:40:48 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat auth client with URL: https://ngw.devices.sberbank.ru:9443/api/v2/oauth
2025-06-11 17:40:48 [main] INFO  c.e.b.service.GigaChatAuthService - Initializing GigaChat API client with URL: https://gigachat.devices.sberbank.ru/api/v1
2025-06-11 17:40:48 [main] WARN  c.e.b.service.GigaChatAuthService - Using insecure SSL configuration - trustAllCertificates is enabled
2025-06-11 17:40:48 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-06-11 17:40:48 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Starting...
2025-06-11 17:40:48 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@52da1357]]
2025-06-11 17:40:48 [main] INFO  o.s.m.s.b.SimpleBrokerMessageHandler - Started.
2025-06-11 17:40:48 [main] INFO  c.example.backend.BackendApplication - Started BackendApplication in 3.431 seconds (process running for 3.709)
2025-06-11 17:40:53 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-11 17:40:53 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-11 17:40:53 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-11 17:40:54 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 17:41:02 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 17:41:02 [http-nio-8080-exec-5] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 17:41:02 [http-nio-8080-exec-6] INFO  c.e.b.controller.AuthController - Retrieved current user: username=andrey, userId=1
2025-06-11 17:41:02 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 17:41:06 [http-nio-8080-exec-4] INFO  c.e.backend.service.ChatService - Created chat: id=13, title=Chat 11
2025-06-11 17:41:06 [http-nio-8080-exec-9] INFO  c.e.b.config.WebSocketMessageHandler - User Disconnected: andrey
2025-06-11 17:41:06 [http-nio-8080-exec-9] INFO  c.e.b.config.WebSocketSessionManager - Removed session for user: andrey
2025-06-11 17:41:06 [clientOutboundChannel-1] INFO  c.e.b.config.WebSocketMessageHandler - User Connected: andrey
2025-06-11 17:41:07 [http-nio-8080-exec-6] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=13, query=SELECT 
    u.username AS user_name,
    c.title AS chat_title,
    COUNT(m.id) AS message_count,
    dc.name AS db_connection_name,
    dc.db_type,
    dc.host,
    dc.port
FROM 
    users u, llm=Local
2025-06-11 17:41:07 [http-nio-8080-exec-6] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-11 17:41:07 [http-nio-8080-exec-6] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=13, query=SELECT 
    u.username AS user_name,
    c.title AS chat_title,
    COUNT(m.id) AS message_count,
    dc.name AS db_connection_name,
    dc.db_type,
    dc.host,
    dc.port
FROM 
    users u, llm=Local, isMPP=false
2025-06-11 17:41:21 [http-nio-8080-exec-6] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/13: id=113
2025-06-11 17:41:21 [http-nio-8080-exec-6] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=48
2025-06-11 17:41:48 [MessageBroker-1] INFO  o.s.w.s.c.WebSocketMessageBrokerStats - WebSocketSession[1 current WS(1)-HttpStream(0)-HttpPoll(0), 3 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(3)-CONNECTED(3)-DISCONNECT(1)], stompBrokerRelay[null], inboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 33], outboundChannel[pool size = 1, active threads = 0, queued tasks = 0, completed tasks = 7], sockJsScheduler[pool size = 7, active threads = 1, queued tasks = 1, completed tasks = 2]
2025-06-11 17:42:27 [http-nio-8080-exec-7] INFO  c.e.b.c.SqlOptimizationController - Received SQL optimization request: chatId=13, query=SELECT 
    u.username AS user_name,
    c.title AS chat_title,
    COUNT(m.id) AS message_count,
    dc.name AS db_connection_name,
    dc.db_type,
    dc.host,
    dc.port
FROM 
    users u, llm=Local
2025-06-11 17:42:27 [http-nio-8080-exec-7] INFO  c.e.b.c.SqlOptimizationController - User ID: 1
2025-06-11 17:42:27 [http-nio-8080-exec-7] INFO  c.e.b.service.SqlOptimizationService - Starting query optimization for userId=1, chatId=13, query=SELECT 
    u.username AS user_name,
    c.title AS chat_title,
    COUNT(m.id) AS message_count,
    dc.name AS db_connection_name,
    dc.db_type,
    dc.host,
    dc.port
FROM 
    users u, llm=Local, isMPP=false
2025-06-11 17:42:41 [http-nio-8080-exec-7] INFO  c.e.b.service.SqlOptimizationService - Successfully sent message to /topic/chat/13: id=114
2025-06-11 17:42:41 [http-nio-8080-exec-7] INFO  c.e.b.c.SqlOptimizationController - SQL optimization successful: responseId=49
